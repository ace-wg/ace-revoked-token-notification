<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Notification of Revoked Access Tokens in the Authentication and Authorization for Constrained Environments (ACE) Framework</title>
<meta content="Marco Tiloca" name="author">
<meta content="Francesca Palombini" name="author">
<meta content="Sebastian Echeverria" name="author">
<meta content="Grace Lewis" name="author">
<meta content="
       This document specifies a method of the Authentication and Authorization for Constrained  Environments (ACE) framework, which allows an Authorization Server to notify Clients and Resource Servers (i.e., registered devices) about revoked access tokens. As specified in this document, the method allows Clients and Resource Servers to access a Token Revocation List on the Authorization Server by using the Constrained Application Protocol (CoAP), with the possible additional use of resource observation. Resulting (unsolicited) notifications of revoked access tokens complement alternative approaches such as token introspection, while not requiring additional endpoints on Clients and Resource Servers. 
    " name="description">
<meta content="xml2rfc 3.20.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-ace-revoked-token-notification-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.20.1
    Python 3.11.8
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.2.0
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-ace-revoked-token-notification.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Notification of Revoked Tokens in ACE</td>
<td class="right">April 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca, et al.</td>
<td class="center">Expires 19 October 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">ACE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ace-revoked-token-notification-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-04-17" class="published">17 April 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-10-19">19 October 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">F. Palombini</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">S. Echeverria</div>
<div class="org">CMU SEI</div>
</div>
<div class="author">
      <div class="author-name">G. Lewis</div>
<div class="org">CMU SEI</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Notification of Revoked Access Tokens in the Authentication and Authorization for Constrained Environments (ACE) Framework</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a method of the Authentication and Authorization for Constrained  Environments (ACE) framework, which allows an Authorization Server to notify Clients and Resource Servers (i.e., registered devices) about revoked access tokens. As specified in this document, the method allows Clients and Resource Servers to access a Token Revocation List on the Authorization Server by using the Constrained Application Protocol (CoAP), with the possible additional use of resource observation. Resulting (unsolicited) notifications of revoked access tokens complement alternative approaches such as token introspection, while not requiring additional endpoints on Clients and Resource Servers.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Authentication and Authorization for Constrained Environments Working Group mailing list (ace@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ace/">https://mailarchive.ietf.org/arch/browse/ace/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/ace-wg/ace-revoked-token-notification">https://github.com/ace-wg/ace-revoked-token-notification</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 19 October 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-token-hash" class="internal xref">Token Hash</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-token-revocation-list-trl" class="internal xref">Token Revocation List (TRL)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-update-of-the-trl" class="internal xref">Update of the TRL</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-the-trl-endpoint" class="internal xref">The TRL Endpoint</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-supporting-diff-queries" class="internal xref">Supporting Diff Queries</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-supporting-the-cursor-exten" class="internal xref">Supporting the "Cursor" Extension</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-query-parameters" class="internal xref">Query Parameters</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-full-query-of-the-trl" class="internal xref">Full Query of the TRL</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-diff-query-of-the-trl" class="internal xref">Diff Query of the TRL</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-response-messages-when-usin" class="internal xref">Response Messages when Using the "Cursor" Extension</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-response-to-full-query" class="internal xref">Response to Full Query</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-response-to-diff-query" class="internal xref">Response to Diff Query</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="auto internal xref">8.2.1</a>.  <a href="#name-empty-collection" class="internal xref">Empty Collection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="auto internal xref">8.2.2</a>.  <a href="#name-cursor-not-specified-in-the" class="internal xref">Cursor Not Specified in the Diff Query Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.3">
                    <p id="section-toc.1-1.8.2.2.2.3.1"><a href="#section-8.2.3" class="auto internal xref">8.2.3</a>.  <a href="#name-cursor-specified-in-the-dif" class="internal xref">Cursor Specified in the Diff Query Request</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-registration-at-the-authori" class="internal xref">Registration at the Authorization Server</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-notification-of-revoked-acc" class="internal xref">Notification of Revoked Access Tokens</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-handling-of-access-tokens-a" class="internal xref">Handling of Access Tokens and Token Hashes</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-ace-token-revocation-list-p" class="internal xref">ACE Token Revocation List Parameters</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-ace-token-revocation-list-e" class="internal xref">ACE Token Revocation List Error Identifiers</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="auto internal xref">13.1</a>.  <a href="#name-content-retrieval-from-the-" class="internal xref">Content Retrieval from the TRL</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="auto internal xref">13.2</a>.  <a href="#name-size-of-the-trl" class="internal xref">Size of the TRL</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#section-13.3" class="auto internal xref">13.3</a>.  <a href="#name-communication-patterns" class="internal xref">Communication Patterns</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#section-13.4" class="auto internal xref">13.4</a>.  <a href="#name-request-of-new-access-token" class="internal xref">Request of New Access Tokens</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.5">
                <p id="section-toc.1-1.13.2.5.1"><a href="#section-13.5" class="auto internal xref">13.5</a>.  <a href="#name-dishonest-clients" class="internal xref">Dishonest Clients</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="auto internal xref">14.1</a>.  <a href="#name-media-type-registrations" class="internal xref">Media Type Registrations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="auto internal xref">14.2</a>.  <a href="#name-coap-content-formats-regist" class="internal xref">CoAP Content-Formats Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#section-14.3" class="auto internal xref">14.3</a>.  <a href="#name-ace-token-revocation-list-pa" class="internal xref">ACE Token Revocation List Parameters Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a href="#section-14.4" class="auto internal xref">14.4</a>.  <a href="#name-ace-token-revocation-list-err" class="internal xref">ACE Token Revocation List Errors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.5">
                <p id="section-toc.1-1.14.2.5.1"><a href="#section-14.5" class="auto internal xref">14.5</a>.  <a href="#name-expert-review-instructions" class="internal xref">Expert Review Instructions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="auto internal xref">15.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="auto internal xref">15.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-on-using-the-series-transfe" class="internal xref">On using the Series Transfer Pattern</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-parameters-of-the-trl-endpo" class="internal xref">Parameters of the TRL Endpoint</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-interaction-examples" class="internal xref">Interaction Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.1">
                <p id="section-toc.1-1.18.2.1.1"><a href="#appendix-C.1" class="auto internal xref">C.1</a>.  <a href="#name-full-query-with-observe" class="internal xref">Full Query with Observe</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.2">
                <p id="section-toc.1-1.18.2.2.1"><a href="#appendix-C.2" class="auto internal xref">C.2</a>.  <a href="#name-diff-query-with-observe" class="internal xref">Diff Query with Observe</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.3">
                <p id="section-toc.1-1.18.2.3.1"><a href="#appendix-C.3" class="auto internal xref">C.3</a>.  <a href="#name-full-query-with-observe-plu" class="internal xref">Full Query with Observe plus Diff Query</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.4">
                <p id="section-toc.1-1.18.2.4.1"><a href="#appendix-C.4" class="auto internal xref">C.4</a>.  <a href="#name-diff-query-with-observe-and" class="internal xref">Diff Query with Observe and "Cursor"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.5">
                <p id="section-toc.1-1.18.2.5.1"><a href="#appendix-C.5" class="auto internal xref">C.5</a>.  <a href="#name-full-query-with-observe-plus" class="internal xref">Full Query with Observe plus Diff Query with "Cursor"</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.  <a href="#name-document-updates" class="internal xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.1">
                <p id="section-toc.1-1.19.2.1.1"><a href="#appendix-D.1" class="auto internal xref">D.1</a>.  <a href="#name-version-05-to-06" class="internal xref">Version -05 to -06</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.2">
                <p id="section-toc.1-1.19.2.2.1"><a href="#appendix-D.2" class="auto internal xref">D.2</a>.  <a href="#name-version-04-to-05" class="internal xref">Version -04 to -05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.3">
                <p id="section-toc.1-1.19.2.3.1"><a href="#appendix-D.3" class="auto internal xref">D.3</a>.  <a href="#name-version-03-to-04" class="internal xref">Version -03 to -04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.4">
                <p id="section-toc.1-1.19.2.4.1"><a href="#appendix-D.4" class="auto internal xref">D.4</a>.  <a href="#name-version-02-to-03" class="internal xref">Version -02 to -03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.5">
                <p id="section-toc.1-1.19.2.5.1"><a href="#appendix-D.5" class="auto internal xref">D.5</a>.  <a href="#name-version-01-to-02" class="internal xref">Version -01 to -02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.6">
                <p id="section-toc.1-1.19.2.6.1"><a href="#appendix-D.6" class="auto internal xref">D.6</a>.  <a href="#name-version-00-to-01" class="internal xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.21">
            <p id="section-toc.1-1.21.1"><a href="#appendix-F" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Authentication and Authorization for Constrained Environments (ACE) <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> is a framework that enforces access control on IoT devices acting as Resource Servers. In order to use ACE, both Clients and Resource Servers have to register with an Authorization Server (AS) and become a registered device. Once registered, a Client can send a request to the AS, to obtain an access token for a Resource Server (RS). For a Client to access the RS, the Client must present the issued access token at the RS, which then validates it before storing it (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.1.1" class="relref">Section 5.10.1.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>).<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Even though access tokens have expiration times, there are circumstances by which an access token may need to be revoked before its expiration time, such as: (1) a registered device has been compromised, or is suspected of being compromised; (2) a registered device is decommissioned; (3) there has been a change in the ACE profile for a registered device; (4) there has been a change in access policies for a registered device; and (5) there has been a change in the outcome of policy evaluation for a registered device (e.g., if policy assessment depends on dynamic conditions in the execution environment, the user context, or the resource utilization).<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">As discussed in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-6.1" class="relref">Section 6.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, only client-initiated revocation is currently specified <span>[<a href="#RFC7009" class="cite xref">RFC7009</a>]</span> for OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>, based on the assumption that access tokens in OAuth are issued with a relatively short lifetime. However, this is not expected to be the case for constrained, intermittently connected devices, that need access tokens with relatively long lifetimes.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document specifies a method for allowing registered devices to access and possibly subscribe to a Token Revocation List (TRL) on the AS, in order to obtain updated information about pertaining access tokens that were revoked prior to their expiration. As specified in this document, the registered devices use the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> to communicate with the AS and with one another, and can subscribe to the TRL on the AS by using resource observation for CoAP <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>. Other underlying protocols than CoAP are not prohibited from being supported in the future, if they are defined to be used in the ACE framework for Authentication and Authorization.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Unlike in the case of token introspection (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), a registered device does not provide an owned access token to the AS for inquiring about its current state. Instead, registered devices simply obtain updated information about pertaining access tokens that were revoked prior to their expiration, as efficiently identified by corresponding hash values.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">The benefits of this method are that it complements token introspection, and it does not require any additional endpoints on the registered devices. The only additional requirements for registered devices are a request/response interaction with the AS to access and possibly subscribe to the TRL (see <a href="#sec-overview" class="auto internal xref">Section 2</a>), and the lightweight computation of hash values to use as Token identifiers (see <a href="#sec-token-name" class="auto internal xref">Section 3</a>).<a href="#section-1-6" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts described in the ACE framework for Authentication and Authorization <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, as well as with terms and concepts related to CBOR Web Tokens (CWTs) <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>, and JSON Web Tokens (JWTs) <span>[<a href="#RFC7519" class="cite xref">RFC7519</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">The terminology for entities in the considered architecture is defined in OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>. In particular, this includes Client, Resource Server (RS), and Authorization Server (AS).<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">Readers are also expected to be familiar with the terms and concepts related to CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>, JSON <span>[<a href="#RFC8259" class="cite xref">RFC8259</a>]</span>, the CoAP protocol <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, and the use of hash functions to name objects as defined in <span>[<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">Note that, unless otherwise indicated, the term "endpoint" is used here following its OAuth definition, aimed at denoting resources such as /token and /introspect at the AS, and /authz-info at the RS. This document does not use the CoAP definition of "endpoint", which is "An entity participating in the CoAP protocol."<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6">This specification also refers to the following terminology.<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-7.1">
            <p id="section-1.1-7.1.1">Token hash: identifier of an access token, in binary format encoding. The token hash has no relation to other possibly used token identifiers, such as the 'cti' (CWT ID) claim of CBOR Web Tokens (CWTs) <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>.<a href="#section-1.1-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-7.2">
            <p id="section-1.1-7.2.1">Token Revocation List (TRL): a collection of token hashes such that the corresponding access tokens have been revoked but are not expired yet.<a href="#section-1.1-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-7.3">
            <p id="section-1.1-7.3.1">TRL endpoint: an endpoint on the AS with a TRL as its representation. The default name of the TRL endpoint in a url-path is '/revoke/trl'. Implementations are not required to use this name, and can define their own instead.<a href="#section-1.1-7.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-7.4">
            <p id="section-1.1-7.4.1">Registered device: a device registered at the AS, i.e., as a Client, or an RS, or both. A registered device acts as a requester towards the TRL endpoint.<a href="#section-1.1-7.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-7.5">
            <p id="section-1.1-7.5.1">Administrator: entity authorized to get full access to the TRL at the AS, and acting as a requester towards the TRL endpoint. An administrator is not necessarily a registered device as defined above, i.e., a Client requesting access tokens or an RS consuming access tokens. How the administrator authorization is established and verified is out of the scope of this specification.<a href="#section-1.1-7.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-7.6">
            <p id="section-1.1-7.6.1">Pertaining access token:<a href="#section-1.1-7.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-7.6.2.1">
                <p id="section-1.1-7.6.2.1.1">With reference to an administrator, an access token issued by the AS.<a href="#section-1.1-7.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.1-7.6.2.2">
                <p id="section-1.1-7.6.2.2.1">With reference to a registered device, an access token intended to be owned by that device. An access token pertains to a Client if the AS has issued the access token for that Client following its request. An access token pertains to an RS if the AS has issued the access token to be consumed by that RS.<a href="#section-1.1-7.6.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-1.1-8">Examples throughout this document are expressed in CBOR diagnostic notation without the tag and value abbreviations.<a href="#section-1.1-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-overview">
<section id="section-2">
      <h2 id="name-protocol-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-2-1">This protocol defines how a CoAP-based Authorization Server informs Clients and Resource Servers, i.e., registered devices, about pertaining revoked access tokens. How the relationship between a registered device and the AS is established is out of the scope of this specification.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">At a high level, the steps of this protocol are as follows.<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">
          <p id="section-2-3.1.1">Upon startup, the AS creates a single TRL accessible through the TRL endpoint. At any point in time, the TRL represents the list of all revoked access tokens issued by the AS that are not expired yet.<a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.2">
          <p id="section-2-3.2.1">When a device registers at the AS, it also receives the url-path to the TRL endpoint.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
<p id="section-2-3.2.2">
After the registration procedure is finished, the registered device can send an Observation Request to the TRL endpoint as described in <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, i.e., a GET request including the CoAP Observe Option set to 0 (register). By doing so, the registered device effectively subscribes to the TRL, as interested to receive notifications about its update. Upon receiving the request, the AS adds the registered device to the list of observers of the TRL endpoint.<a href="#section-2-3.2.2" class="pilcrow">¶</a></p>
<p id="section-2-3.2.3">
At any time, the registered device can send a GET request to the TRL endpoint. When doing so, it can request for: the current list of pertaining revoked access tokens (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>); or the most recent updates occurred over the list of pertaining revoked access tokens (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>). In either case, the registered device may also rely on an Observation Request for subscribing to the TRL as discussed above.<a href="#section-2-3.2.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.3">
          <p id="section-2-3.3.1">When an access token is revoked, the AS adds the corresponding token hash to the TRL. Also, when a revoked access token eventually expires, the AS removes the corresponding token hash from the TRL.<a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
<p id="section-2-3.3.2">
In either case, after updating the TRL, the AS sends Observe notifications as per <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>. That is, an Observe notification is sent to each registered device subscribed to the TRL and to which the access token pertains.<a href="#section-2-3.3.2" class="pilcrow">¶</a></p>
<p id="section-2-3.3.3">
Depending on the specific subscription established through the observation request, the notification provides the current updated list of revoked access tokens in the subset of the TRL pertaining to that device (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>), or rather the most recent TRL updates occurred over that list of pertaining revoked access tokens (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>).<a href="#section-2-3.3.3" class="pilcrow">¶</a></p>
<p id="section-2-3.3.4">
Further Observe notifications may be sent, consistently with ongoing additional observations of the TRL endpoint.<a href="#section-2-3.3.4" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.4">
          <p id="section-2-3.4.1">An administrator can access and subscribe to the TRL like a registered device, while getting the full updated content of the TRL.<a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-4"><a href="#fig-protocol-overview" class="auto internal xref">Figure 1</a> shows a high-level overview of the service provided by this protocol. For the sake of simplicity, the example shown in the figure considers the simultaneous revocation of the three access tokens t1, t2 and t3, with token hash th1, th2 and th3, respectively.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">Consistently, the AS adds the three token hashes to the TRL at once, and sends Observe notifications to one administrator and four registered devices. Each dotted line associated with a pair of registered devices indicates the access token that they both own.<a href="#section-2-5" class="pilcrow">¶</a></p>
<span id="name-protocol-overview-2"></span><div id="fig-protocol-overview">
<figure id="figure-1">
        <div class="alignCenter art-text artwork" id="section-2-6.1">
<pre>
                    +----------------------+
                    | Authorization Server |
                    +-----------o----------+
                    revoke/trl  |  TRL: (th1,th2,th3)
                                |
 +-----------------+------------+------------+------------+
 |                 |            |            |            |
 | th1,th2,th3     | th1,th2    | th1        | th3        | th2,th3
 v                 v            v            v            v
+---------------+ +----------+ +----------+ +----------+ +----------+
| Administrator | | Client 1 | | Resource | | Client 2 | | Resource |
|               | |          | | Server 1 | |          | | Server 2 |
+---------------+ +----------+ +----------+ +----------+ +----------+
                     :    :        :           :            :    :
                     :    :   t1   :           :     t3     :    :
                     :    :........:           :............:    :
                     :                   t2                      :
                     :...........................................:

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-protocol-overview-2" class="selfRef">Protocol Overview</a>
        </figcaption></figure>
</div>
<p id="section-2-7"><a href="#sec-RS-examples" class="auto internal xref">Appendix C</a> provides examples of the protocol flow and message exchange between the AS and a registered device.<a href="#section-2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-token-name">
<section id="section-3">
      <h2 id="name-token-hash">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-token-hash" class="section-name selfRef">Token Hash</a>
      </h2>
<p id="section-3-1">The token hash of an access token is computed as follows.<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">
          <p id="section-3-2.1.1">The AS considers the content of the 'access_token' parameter in the AS-to-Client response (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), where the Access Token was included and provided to the requesting Client.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.2">
          <p id="section-3-2.2.1">The AS defines HASH_INPUT as follows.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.2.2.1">
              <p id="section-3-2.2.2.1.1">If the content of the 'access_token' parameter from step 1 is a CBOR byte string, then HASH_INPUT takes the binary serialization of that CBOR byte string. This is the case where CBOR was used to transport the Access Token (as a CWT or JWT).<a href="#section-3-2.2.2.1.1" class="pilcrow">¶</a></p>
<p id="section-3-2.2.2.1.2">
With reference to the example in <a href="#fig-as-response-cbor" class="auto internal xref">Figure 2</a>, and assuming the string's length in bytes to be 119 (i.e., 0x77 in hexadecimal), then HASH_INPUT takes the bytes {0x58 0x77 0xd0 0x83 0x44 0xa1 ...}, i.e., the raw content of the 'access_token' parameter.<a href="#section-3-2.2.2.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3-2.2.2.2">
              <p id="section-3-2.2.2.2.1">If the content of the 'access_token' parameter from step 1 is a text string, then HASH_INPUT takes the binary serialization of that text string. This is the case where JSON was used to transport the Access Token (as a CWT or JWT).<a href="#section-3-2.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-3-2.2.2.2.2">
With reference to the example in <a href="#fig-as-response-json" class="auto internal xref">Figure 3</a>, HASH_INPUT is the binary serialization of "2YotnFZFEjr1zCsicMWpAA", i.e., of the raw content of the 'access_token' parameter.<a href="#section-3-2.2.2.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-3-2.2.3">
In either case, HASH_INPUT results in the binary representation of the raw content of the 'access_token' parameter from the AS-to-Client response.<a href="#section-3-2.2.3" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.3">
          <p id="section-3-2.3.1">The AS generates a hash value of HASH_INPUT as per <span><a href="https://rfc-editor.org/rfc/rfc6920#section-6" class="relref">Section 6</a> of [<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>. The resulting output in binary format is used as the token hash. Note that the used binary format embeds the identifier of the used hash function, in the first byte of the computed token hash.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
<p id="section-3-2.3.2">
The specifically used hash function MUST be collision-resistant on byte-strings, and MUST be selected from the "Named Information Hash Algorithm" Registry <span>[<a href="#Named.Information.Hash.Algorithm" class="cite xref">Named.Information.Hash.Algorithm</a>]</span>.<a href="#section-3-2.3.2" class="pilcrow">¶</a></p>
<p id="section-3-2.3.3">
The AS specifies the used hash function to registered devices during their registration procedure (see <a href="#sec-registration" class="auto internal xref">Section 9</a>).<a href="#section-3-2.3.3" class="pilcrow">¶</a></p>
</li>
      </ol>
<span id="name-example-of-as-to-client-res"></span><div id="fig-as-response-cbor">
<figure id="figure-2">
        <div class="alignLeft art-text artwork" id="section-3-3.1">
<pre>
2.01 Created
Content-Format: application/ace+cbor
Max-Age: 85800
Payload:
{
   "access_token" : h'd08344a1 ...
    (remainder of the access token omitted for brevity) ...',
   "token_type" : pop,
   "expires_in" : 86400,
   "profile" : coap_dtls,
   (remainder of the response omitted for brevity)
}
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-example-of-as-to-client-res" class="selfRef">Example of AS-to-Client response using CBOR</a>
        </figcaption></figure>
</div>
<span id="name-example-of-as-to-client-resp"></span><div id="fig-as-response-json">
<figure id="figure-3">
        <div class="alignLeft art-text artwork" id="section-3-4.1">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache
Payload:
{
   "access_token" : "2YotnFZFEjr1zCsicMWpAA",
   "token_type" : "pop",
   "expires_in" : 86400,
   "profile" : "coap_dtls",
   (remainder of the response omitted for brevity)
}
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-of-as-to-client-resp" class="selfRef">Example of AS-to-Client response using JSON</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-trl-resource">
<section id="section-4">
      <h2 id="name-token-revocation-list-trl">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-token-revocation-list-trl" class="section-name selfRef">Token Revocation List (TRL)</a>
      </h2>
<p id="section-4-1">Upon startup, the AS creates a single Token Revocation List (TRL), encoded as a CBOR array.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Each element of the array is a CBOR byte string, with value the token hash of an access token. The CBOR array MUST be treated as a set, i.e., the order of its elements has no meaning.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The TRL is initialized as empty, i.e., its initial content MUST be the empty CBOR array. The TRL is accessible through the TRL endpoint on the AS.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="ssec-trl-update">
<section id="section-4.1">
        <h3 id="name-update-of-the-trl">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-update-of-the-trl" class="section-name selfRef">Update of the TRL</a>
        </h3>
<p id="section-4.1-1">The AS updates the TRL in the following two cases.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">When a non-expired access token is revoked, the token hash of the access token is added to the TRL. That is, a CBOR byte string with the token hash as its value is added to the CBOR array encoding the TRL.<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">When a revoked access token expires, the token hash of the access token is removed from the TRL. That is, the CBOR byte string with the token hash as its value is removed from the CBOR array encoding the TRL.<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-3">The AS MAY perform a single update to the TRL such that one or more token hashes are added or removed at once. For example, this can be the case if multiple access tokens are revoked or expire at the same time, or within an acceptably narrow time window.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-trl-endpoint">
<section id="section-5">
      <h2 id="name-the-trl-endpoint">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-the-trl-endpoint" class="section-name selfRef">The TRL Endpoint</a>
      </h2>
<p id="section-5-1">Consistent with <span><a href="https://rfc-editor.org/rfc/rfc9200#section-6.5" class="relref">Section 6.5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, all communications between a requester towards the TRL endpoint and the AS MUST be encrypted, as well as integrity and replay protected. Furthermore, responses from the AS to the requester MUST be bound to the corresponding requests.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Following a request to the TRL endpoint, the corresponding response messages sent by the AS use Content-Format "application/ace-trl+cbor". Their payload is formatted as a CBOR map, and the CBOR values for the parameters included therein are defined in <a href="#trl-registry-parameters" class="auto internal xref">Section 11</a>.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The AS MUST implement measures to prevent access to the TRL endpoint by entities other than registered devices and authorized administrators.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The TRL endpoint supports only the GET method, and allows two types of queries of the TRL.<a href="#section-5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-5.1">
          <p id="section-5-5.1.1">Full query: the AS returns the token hashes of the revoked access tokens currently in the TRL and pertaining to the requester.<a href="#section-5-5.1.1" class="pilcrow">¶</a></p>
<p id="section-5-5.1.2">
The AS MUST support this type of query. The processing of a full query and the related response format are defined in <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>.<a href="#section-5-5.1.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-5.2">
          <p id="section-5-5.2.1">Diff query: the AS returns a list of diff entries. Each diff entry is related to one of the most recent updates to the TRL, with such an update performed in the subset of the TRL pertaining to the requester.<a href="#section-5-5.2.1" class="pilcrow">¶</a></p>
<p id="section-5-5.2.2">
The entry associated with one of such updates contains a list of token hashes, such that: i) the corresponding revoked access tokens pertain to the requester; and ii) they were added to or removed from the TRL when performing that update to the TRL.<a href="#section-5-5.2.2" class="pilcrow">¶</a></p>
<p id="section-5-5.2.3">
The AS MAY support this type of query. In such a case, the AS maintains the history of updates to the TRL as defined in <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a>. The processing of a diff query and the related response format are defined in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>.<a href="#section-5-5.2.3" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-6">If it supports diff queries, the AS MAY additionally support its "Cursor" extension, which has two benefits. First, the AS can avoid excessively big latencies when several diff entries have to be transferred, by delivering one adjacent subset at the time, in different diff query responses. Second, a requester can retrieve diff entries associated with TRL updates that, even if not the most recent ones, occurred after a TRL update indicated as reference point.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">If it supports the "Cursor" extension, the AS stores additional information when maintaining the history of updates to the TRL, as defined in <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>. Also, the processing of full query requests and diff query requests, as well as the related response format, are further extended as defined in <a href="#sec-using-cursor" class="auto internal xref">Section 8</a>.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8"><a href="#sec-trl-parameteters" class="auto internal xref">Appendix B</a> provides an aggregated overview of the parameters used by the TRL endpoint, when the AS supports diff queries and the "Cursor" extension.<a href="#section-5-8" class="pilcrow">¶</a></p>
<div id="sec-trl-endpoint-supporting-diff-queries">
<section id="section-5.1">
        <h3 id="name-supporting-diff-queries">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-supporting-diff-queries" class="section-name selfRef">Supporting Diff Queries</a>
        </h3>
<p id="section-5.1-1">If the AS supports diff queries, it is able to transfer a list of diff entries, as a series of TRL updates. That is, when replying to a diff query performed by a requester, the AS specifies the most recent updates to the subset of the TRL pertaining to that requester.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The following defines how the AS builds and maintains consistent histories of TRL updates for each registered device and administrator, hereafter referred to as requesters.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">The AS defines the single, constant positive integer MAX_N &gt;= 1. For each requester, the AS maintains an update collection of maximum MAX_N series items. The AS MUST keep track of the MAX_N most recent updates to the subset of the TRL that pertains to each requester. The AS SHOULD provide requesters with the value of MAX_N, upon their registration (see <a href="#sec-registration" class="auto internal xref">Section 9</a>).<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">The series items in the update collection MUST be strictly ordered in a chronological fashion. That is, at any point in time, the current first series item is the one least recently added to the update collection and still retained by the AS, while the current last series item is the one most recently added to the update collection. The particular method used to achieve this is implementation-specific.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">Each time the TRL changes, the AS performs the following operations for each requester.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-6">
<li id="section-5.1-6.1">
            <p id="section-5.1-6.1.1">The AS considers the subset of the TRL pertaining to that requester. If the TRL subset is not affected by this TRL update, the AS stops the processing for that requester. Otherwise, the AS moves to step 2.<a href="#section-5.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-6.2">
            <p id="section-5.1-6.2.1">The AS creates two sets "trl_patch" of token hashes, i.e., one  "removed" set and one "added" set, as related to this TRL update.<a href="#section-5.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-6.3">
            <p id="section-5.1-6.3.1">The AS fills the two sets with the token hashes of the removed and added access tokens, respectively, from/to the TRL subset considered at step 1.<a href="#section-5.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-6.4">
            <p id="section-5.1-6.4.1">The AS creates a new series item, which includes the two sets from step 3.<a href="#section-5.1-6.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-6.5">
            <p id="section-5.1-6.5.1">If the update collection associated with the requester currently includes MAX_N series items, the AS MUST delete the oldest series item in the update collection.<a href="#section-5.1-6.5.1" class="pilcrow">¶</a></p>
<p id="section-5.1-6.5.2">
This occurs when the number of TRL updates pertaining to the requester and currently stored at the AS is equal to MAX_N.<a href="#section-5.1-6.5.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-6.6">
            <p id="section-5.1-6.6.1">The AS adds the series item to the update collection associated with the requester, as the most recent one.<a href="#section-5.1-6.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="sec-trl-endpoint-supporting-cursor">
<section id="section-5.1.1">
          <h4 id="name-supporting-the-cursor-exten">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-supporting-the-cursor-exten" class="section-name selfRef">Supporting the "Cursor" Extension</a>
          </h4>
<p id="section-5.1.1-1">If it supports the "Cursor" extension for diff queries, the AS performs also the following actions.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2">The AS defines the single, constant unsigned integer MAX_INDEX &lt;= ((2^64) - 1), where "^" is the exponentiation operator. In particular, the value of MAX_INDEX is REQUIRED to be at least (MAX_N - 1), and is RECOMMENDED to be at least ((2^32) - 1). Note that MAX_INDEX is practically expected to be order of magnitudes greater than MAX_N.<a href="#section-5.1.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1.1-3">When maintaining the history of updates to the TRL, the following applies separately for each update collection.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-4.1">
              <p id="section-5.1.1-4.1.1">Each series item X in the update collection is also associated with an unsigned integer 'index', whose minimum value is 0 and whose maximum value is MAX_INDEX. The first series item ever added to the update collection MUST have 'index' with value 0.<a href="#section-5.1.1-4.1.1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4.1.2">
If i_X is the value of 'index' associated with a series item X, then the following series item Y will take 'index' with value i_Y = (i_X + 1) % (MAX_INDEX + 1). That is, after having added a series item whose associated 'index' has value MAX_INDEX, the next added series item will result in a wrap-around of the 'index' value, and will thus take 'index' with value 0.<a href="#section-5.1.1-4.1.2" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4.1.3">
For example, assuming MAX_N = 3, the values of 'index' in the update collection chronologically evolve as follows, as new series items are added and old series items are deleted.<a href="#section-5.1.1-4.1.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-4.1.4.1">
                  <p id="section-5.1.1-4.1.4.1.1">...<a href="#section-5.1.1-4.1.4.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.1-4.1.4.2">
                  <p id="section-5.1.1-4.1.4.2.1">( i_A = MAX_INDEX - 2, i_B = MAX_INDEX - 1, i_C = MAX_INDEX )<a href="#section-5.1.1-4.1.4.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.1-4.1.4.3">
                  <p id="section-5.1.1-4.1.4.3.1">( i_B = MAX_INDEX - 1, i_C = MAX_INDEX, i_D = 0 )<a href="#section-5.1.1-4.1.4.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.1-4.1.4.4">
                  <p id="section-5.1.1-4.1.4.4.1">( i_C = MAX_INDEX, i_D = 0, i_E = 1 )<a href="#section-5.1.1-4.1.4.4.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.1-4.1.4.5">
                  <p id="section-5.1.1-4.1.4.5.1">( i_D = 0, i_E = 1, i_F = 2 )<a href="#section-5.1.1-4.1.4.5.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.1-4.1.4.6">
                  <p id="section-5.1.1-4.1.4.6.1">...<a href="#section-5.1.1-4.1.4.6.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.1.1-4.2">
              <p id="section-5.1.1-4.2.1">The unsigned integer 'last_index' is also defined, with minimum value 0 and maximum value MAX_INDEX.<a href="#section-5.1.1-4.2.1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4.2.2">
If the update collection is empty (i.e., no series items have been added yet), the value of 'last_index' is not defined. If the update collection is not empty, 'last_index' has the value of 'index' currently associated with the latest added series item in the update collection.<a href="#section-5.1.1-4.2.2" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4.2.3">
That is, after having added V series items to the update collection, the last and most recently added series item has 'index' with value 'last_index' = (V - 1) % (MAX_INDEX + 1).<a href="#section-5.1.1-4.2.3" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4.2.4">
As long as a wrap-around of the 'index' value has not occurred, the value of 'last_index' is the absolute counter of series items added to that update collection until and including V, minus 1.<a href="#section-5.1.1-4.2.4" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.1-5">When processing a diff query using the "Cursor" extension, the values of 'index' are used as cursor information, as defined in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 8.2</a>.<a href="#section-5.1.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1.1-6">For each update collection, the AS also defines a constant, positive integer MAX_DIFF_BATCH &lt;= MAX_N, whose value specifies the maximum number of diff entries to be included in a single diff query response. The specific value depends on the specific registered device or administrator associated with the update collection in question. If supporting the "Cursor" extension, the AS SHOULD provide registered devices and administrators with the value of MAX_DIFF_BATCH, upon their registration (see <a href="#sec-registration" class="auto internal xref">Section 9</a>).<a href="#section-5.1.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-trl-endpoint-query-parameters">
<section id="section-5.2">
        <h3 id="name-query-parameters">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-query-parameters" class="section-name selfRef">Query Parameters</a>
        </h3>
<p id="section-5.2-1">A GET request to the TRL endpoint can include the following query parameters. The AS MUST silently ignore unknown query parameters.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.1">
            <p id="section-5.2-2.1.1">'diff': if included, it indicates to perform a diff query of the TRL (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>). Its value MUST be either:<a href="#section-5.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.1.2.1">
                <p id="section-5.2-2.1.2.1.1">the integer 0, indicating that a (notification) response should include as many diff entries as the AS can provide in the response; or<a href="#section-5.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.2-2.1.2.2">
                <p id="section-5.2-2.1.2.2.1">a positive integer strictly greater than 0, indicating the maximum number of diff entries that a (notification) response should include.<a href="#section-5.2-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-5.2-2.1.3">
If the AS does not support diff queries, it ignores the 'diff' query parameter when present in the GET request, and proceeds like when processing a full query of the TRL (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>).<a href="#section-5.2-2.1.3" class="pilcrow">¶</a></p>
<p id="section-5.2-2.1.4">
Otherwise, the AS MUST return a 4.00 (Bad Request) response in case the 'diff' query parameter of the GET request specifies a value other than 0 or than a positive integer, irrespective of the presence of the 'cursor' parameter and its value (see below). The response MUST have Content-Format "application/ace-trl+cbor". The payload of the response is a CBOR map, which MUST include the 'error' parameter with value 0 ("Invalid parameter value") and MAY include the 'error_description' parameter to provide additional context.<a href="#section-5.2-2.1.4" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-2.2">
            <p id="section-5.2-2.2.1">'cursor': if included, it indicates to perform a diff query of the TRL together with the "Cursor" extension, as defined in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 8.2</a>. Its value MUST be either 0 or a positive integer.<a href="#section-5.2-2.2.1" class="pilcrow">¶</a></p>
<p id="section-5.2-2.2.2">
If included, the 'cursor' query parameter specifies an unsigned integer value that was provided by the AS in a previous response from the TRL endpoint (see <a href="#sec-using-cursor-full-query-response" class="auto internal xref">Section 8.1</a>, <a href="#sec-using-cursor-diff-query-response-no-cursor" class="auto internal xref">Section 8.2.2</a> and <a href="#sec-using-cursor-diff-query-response-cursor" class="auto internal xref">Section 8.2.3</a>).<a href="#section-5.2-2.2.2" class="pilcrow">¶</a></p>
<p id="section-5.2-2.2.3">
If the AS does not support the "Cursor" extension, it ignores the 'cursor' query parameter when present in the GET request. In such a case, the AS proceeds: i) like when processing a diff query of the TRL (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>), if it supports diff queries and the 'diff' query parameter is present in the GET request; or ii) like when processing a full query of the TRL (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>) otherwise.<a href="#section-5.2-2.2.3" class="pilcrow">¶</a></p>
<p id="section-5.2-2.2.4">
If the AS supports both diff queries and the "Cursor" extension, and the GET request specifies the 'cursor' query parameter, then the AS MUST return a 4.00 (Bad Request) response in case any of the conditions below holds.<a href="#section-5.2-2.2.4" class="pilcrow">¶</a></p>
<p id="section-5.2-2.2.5">
The 4.00 (Bad Request) response MUST have Content-Format "application/ace-trl+cbor". The payload of the response MUST be a CBOR map, which MUST include the 'error' parameter and MAY include the 'error_description' parameter to provide additional context.<a href="#section-5.2-2.2.5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.2.6.1">
                <p id="section-5.2-2.2.6.1.1">The GET request does not specify the 'diff' query parameter, irrespective of the value of the 'cursor' parameter.<a href="#section-5.2-2.2.6.1.1" class="pilcrow">¶</a></p>
<p id="section-5.2-2.2.6.1.2">
The 'error' parameter within the CBOR map carried in the payload of the 4.00 (Bad Request) response MUST have value 1 ("Invalid set of parameters").<a href="#section-5.2-2.2.6.1.2" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.2-2.2.6.2">
                <p id="section-5.2-2.2.6.2.1">The 'cursor' query parameter has a value other than 0 or than a positive integer, or it has a value strictly greater than MAX_INDEX (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>).<a href="#section-5.2-2.2.6.2.1" class="pilcrow">¶</a></p>
<p id="section-5.2-2.2.6.2.2">
The 'error' parameter within the CBOR map carried in the payload of the 4.00 (Bad Request) response MUST have value 0 ("Invalid parameter value"). The CBOR map MUST also include the 'cursor' parameter, which MUST specify either: the CBOR simple value "null" (0xf6), if the update collection associated with the requester is empty; or the corresponding current value of 'last_index' otherwise.<a href="#section-5.2-2.2.6.2.2" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.2-2.2.6.3">
                <p id="section-5.2-2.2.6.3.1">All of the following hold: the update collection associated with the requester is not empty; no wrap-around of its 'index' value has occurred; and the 'cursor' query parameter has a value strictly greater than the current 'last_index' on the update collection (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>).<a href="#section-5.2-2.2.6.3.1" class="pilcrow">¶</a></p>
<p id="section-5.2-2.2.6.3.2">
The 'error' parameter within the CBOR map carried in the payload of the 4.00 (Bad Request) response MUST have value 2 ("Out of bound cursor value"). The CBOR map MUST also include the 'cursor' parameter, which MUST specify the current value of 'last_index' for the update collection associated with the requester.<a href="#section-5.2-2.2.6.3.2" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="ssec-trl-full-query">
<section id="section-6">
      <h2 id="name-full-query-of-the-trl">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-full-query-of-the-trl" class="section-name selfRef">Full Query of the TRL</a>
      </h2>
<p id="section-6-1">In order to produce a (notification) response to a GET request asking for a full query of the TRL, the AS performs the following actions.<a href="#section-6-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2">
<li id="section-6-2.1">
          <p id="section-6-2.1.1">From the TRL, the AS builds a set HASHES such that:<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1.2.1">
              <p id="section-6-2.1.2.1.1">If the requester is a registered device, HASHES specifies the token hashes currently in the TRL and associated with the access tokens pertaining to that registered device. The AS can use the authenticated identity of the registered device to perform the necessary filtering on the TRL content.<a href="#section-6-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6-2.1.2.2">
              <p id="section-6-2.1.2.2.1">If the requester is an administrator, HASHES specifies all the token hashes currently in the TRL.<a href="#section-6-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li id="section-6-2.2">
          <p id="section-6-2.2.1">The AS sends a 2.05 (Content) response to the requester. The response MUST have Content-Format "application/ace-trl+cbor". The payload of the response is a CBOR map, which MUST be formatted as follows.<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.2.2.1">
              <p id="section-6-2.2.2.1.1">The 'full_set' parameter MUST be included and specifies a CBOR array 'full_set_value'. Each element of 'full_set_value' specifies one of the token hashes from the set HASHES, encoded as a CBOR byte string. If the set HASHES is empty, the 'full_set' parameter specifies the empty CBOR array.<a href="#section-6-2.2.2.1.1" class="pilcrow">¶</a></p>
<p id="section-6-2.2.2.1.2">
The CBOR array MUST be treated as a set, i.e., the order of its elements has no meaning.<a href="#section-6-2.2.2.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6-2.2.2.2">
              <p id="section-6-2.2.2.2.1">The 'cursor' parameter MUST be included if the AS supports both diff queries and the related "Cursor" extension (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a> and <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>). Its value is specified according to what is defined in <a href="#sec-using-cursor-full-query-response" class="auto internal xref">Section 8.1</a>, and provides the requester with information for performing a follow-up diff query using the "Cursor" extension (see <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 8.2</a>).<a href="#section-6-2.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-6-2.2.2.2.2">
If the AS does not support both diff queries and the "Cursor" extension, this parameter MUST NOT be included. In case the requester does not support both diff queries and the "Cursor" extension, it MUST silently ignore the 'cursor' parameter if present.<a href="#section-6-2.2.2.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ol>
<p id="section-6-3"><a href="#cddl-full" class="auto internal xref">Figure 4</a> provides the CDDL definition <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> of the CBOR array 'full_set_value' specified in the response from the AS, as value of the 'full_set' parameter.<a href="#section-6-3" class="pilcrow">¶</a></p>
<span id="name-cddl-definition-of-full_set"></span><div id="cddl-full">
<figure id="figure-4">
        <div class="alignLeft art-CDDL art-text artwork" id="section-6-4.1">
<pre>
token_hash = bytes
full_set_value = [* token_hash]
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-cddl-definition-of-full_set" class="selfRef">CDDL definition of 'full_set_value'</a>
        </figcaption></figure>
</div>
<p id="section-6-5"><a href="#response-full" class="auto internal xref">Figure 5</a> shows an example of response from the AS, following a full query request to the TRL endpoint. In this example, the AS does not support diff queries nor the "Cursor" extension, hence the 'cursor' parameter is not included in the payload of the response. Also, full token hashes are omitted for brevity.<a href="#section-6-5" class="pilcrow">¶</a></p>
<span id="name-example-of-response-followi"></span><div id="response-full">
<figure id="figure-5">
        <div class="alignLeft art-text artwork" id="section-6-6.1">
<pre>
2.05 Content
Content-Format: application/ace-trl+cbor
Payload:
{
   "full_set" : [
     h'01fa51cc ... ', h'01748190 ... '
   ]
}
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-of-response-followi" class="selfRef">Example of response following a Full Query request to the TRL endpoint</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="ssec-trl-diff-query">
<section id="section-7">
      <h2 id="name-diff-query-of-the-trl">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-diff-query-of-the-trl" class="section-name selfRef">Diff Query of the TRL</a>
      </h2>
<p id="section-7-1">In order to produce a (notification) response to a GET request asking for a diff query of the TRL, the AS performs the following actions.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">Note that, if the AS supports both diff queries and the related "Cursor" extension, the steps 3 and 4 defined below are extended as defined in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 8.2</a>.<a href="#section-7-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7-3">
<li id="section-7-3.1">
          <p id="section-7-3.1.1">The AS defines the positive integer NUM as follows. If the value N specified in the 'diff' query parameter in the GET request is equal to 0 or greater than the pre-defined positive integer MAX_N (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a>), then NUM takes the value of MAX_N. Otherwise, NUM takes N.<a href="#section-7-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-7-3.2">
          <p id="section-7-3.2.1">The AS determines U = min(NUM, SIZE), where SIZE &lt;= MAX_N is the number of TRL updates pertaining to the requester and currently stored at the AS.<a href="#section-7-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-7-3.3">
          <p id="section-7-3.3.1">The AS prepares U diff entries. If U is equal to 0 (e.g., because SIZE is equal to 0 at step 2), then no diff entries are prepared.<a href="#section-7-3.3.1" class="pilcrow">¶</a></p>
<p id="section-7-3.3.2">
The prepared diff entries are related to the U most recent TRL updates pertaining to the requester, as maintained in the update collection for that requester (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a>). In particular, the first diff entry refers to the most recent of such updates, the second diff entry refers to the second from last of such updates, and so on.<a href="#section-7-3.3.2" class="pilcrow">¶</a></p>
<p id="section-7-3.3.3">
Each diff entry is a CBOR array 'diff_entry', which includes the following two elements.<a href="#section-7-3.3.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-3.3.4.1">
              <p id="section-7-3.3.4.1.1">The first element is a 'trl_patch' set of token hashes, encoded as a CBOR array 'removed'. Each element of the array is a CBOR byte string, with value the token hash of an access token such that: it pertained to the requester; and it was removed from the TRL during the update associated with the diff entry.<a href="#section-7-3.3.4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7-3.3.4.2">
              <p id="section-7-3.3.4.2.1">The second element is a 'trl_patch' set of token hashes, encoded as a CBOR array 'added'. Each element of the array is a CBOR byte string, with value the token hash of an access token such that: it pertains to the requester; and it was added to the TRL during the update associated with the diff entry.<a href="#section-7-3.3.4.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7-3.3.5">
The CBOR arrays 'removed' and 'added' MUST be treated as sets, i.e., the order of their elements has no meaning.<a href="#section-7-3.3.5" class="pilcrow">¶</a></p>
</li>
        <li id="section-7-3.4">
          <p id="section-7-3.4.1">The AS prepares a 2.05 (Content) response for the requester. The response MUST have Content-Format "application/ace-trl+cbor". The payload of the response is a CBOR map, which MUST be formatted as follows.<a href="#section-7-3.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-3.4.2.1">
              <p id="section-7-3.4.2.1.1">The 'diff_set' parameter MUST be present and specifies a CBOR array 'diff_set_value' of U elements. Each element of 'diff_set_value' specifies one of the CBOR arrays 'diff_entry' prepared above as diff entry. Note that U might have value 0, in which case 'diff_set_value' is the empty CBOR array.<a href="#section-7-3.4.2.1.1" class="pilcrow">¶</a></p>
<p id="section-7-3.4.2.1.2">
Within 'diff_set_value', the CBOR arrays 'diff_entry' MUST be sorted to reflect the corresponding updates to the TRL in reverse chronological order. That is, the first 'diff_entry' element of 'diff_set_value' relates to the most recent update to the subset of the TRL pertaining to the requester. The second 'diff_entry' element relates to the second from last most recent update to that subset, and so on.<a href="#section-7-3.4.2.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7-3.4.2.2">
              <p id="section-7-3.4.2.2.1">The 'cursor' parameter and the 'more' parameter MUST be included if the AS supports both diff queries and the related "Cursor" extension (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>). Their values are specified according to what is defined in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 8.2</a>, and provide the requester with information for performing a follow-up query of the TRL (see <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 8.2</a>).<a href="#section-7-3.4.2.2.1" class="pilcrow">¶</a></p>
<p id="section-7-3.4.2.2.2">
In case the AS supports diff queries but not the "Cursor" extension, these parameters MUST NOT be included. In case the requester supports diff queries but not the "Cursor" extension, it MUST silently ignore the 'cursor' parameter and the 'more' parameter if present.<a href="#section-7-3.4.2.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ol>
<p id="section-7-4"><a href="#cddl-diff" class="auto internal xref">Figure 6</a> provides the CDDL definition <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> of the CBOR array 'diff_set_value' specified in the response from the AS, as value of the 'diff_set' parameter.<a href="#section-7-4" class="pilcrow">¶</a></p>
<span id="name-cddl-definition-of-diff_set"></span><div id="cddl-diff">
<figure id="figure-6">
        <div class="alignLeft art-CDDL art-text artwork" id="section-7-5.1">
<pre>
   token_hash = bytes
   trl_patch = [* token_hash]
   diff_entry = [removed: trl_patch, added: trl_patch]
   diff_set_value = [* diff_entry]
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-cddl-definition-of-diff_set" class="selfRef">CDDL definition of 'diff_set_value'</a>
        </figcaption></figure>
</div>
<p id="section-7-6"><a href="#response-diff" class="auto internal xref">Figure 7</a> shows an example of response from the AS, following a diff query request to the TRL endpoint, where U = 3 diff entries are specified. In this example, the AS does not support the "Cursor" extension, hence the 'cursor' parameter and the 'more' parameter are not included in the payload of the response. Also, full token hashes are omitted for brevity.<a href="#section-7-6" class="pilcrow">¶</a></p>
<span id="name-example-of-response-followin"></span><div id="response-diff">
<figure id="figure-7">
        <div class="alignLeft art-text artwork" id="section-7-7.1">
<pre>
2.05 Content
Content-Format: application/ace-trl+cbor
Payload:
{
   "diff_set" : [
     [
       [ h'01fa51cc ... ', h'01748190 ... '],
       [ h'01cdf1ca ... ', h'01be41a6 ... ']
     ],
     [
       [ h'0144dd12 ... ', h'01231fff ... '],
       []
     ],
     [
       [],
       [ h'01ca986f ... ', h'01fe1a2b ... ']
     ]
   ]
}
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-example-of-response-followin" class="selfRef">Example of response following a Diff Query request to the TRL endpoint</a>
        </figcaption></figure>
</div>
<p id="section-7-8"><a href="#sec-series-pattern" class="auto internal xref">Appendix A</a> discusses how performing a diff query of the TRL is in fact a usage example of the Series Transfer Pattern defined in <span>[<a href="#I-D.bormann-t2trg-stp" class="cite xref">I-D.bormann-t2trg-stp</a>]</span>.<a href="#section-7-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-using-cursor">
<section id="section-8">
      <h2 id="name-response-messages-when-usin">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-response-messages-when-usin" class="section-name selfRef">Response Messages when Using the "Cursor" Extension</a>
      </h2>
<p id="section-8-1">If it supports both diff queries and the "Cursor" extension, the AS composes a response to a full query request or diff query request as defined in <a href="#sec-using-cursor-full-query-response" class="auto internal xref">Section 8.1</a> and <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 8.2</a>, respectively.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">The exact format of the response depends on the request being a full query or diff query request, on the presence of the 'diff' and 'cursor' query parameters and their values in the diff query request, and on the current status of the update collection associated with the requester.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">Error handling and the possible resulting error responses are as defined in <a href="#sec-trl-endpoint-query-parameters" class="auto internal xref">Section 5.2</a>.<a href="#section-8-3" class="pilcrow">¶</a></p>
<div id="sec-using-cursor-full-query-response">
<section id="section-8.1">
        <h3 id="name-response-to-full-query">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-response-to-full-query" class="section-name selfRef">Response to Full Query</a>
        </h3>
<p id="section-8.1-1">When processing a full query request to the TRL endpoint, the AS composes a response as defined in <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">In particular, the 'cursor' parameter included in the CBOR map carried in the response payload specifies either the CBOR simple value "null" (0xf6) or a CBOR unsigned integer.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">The 'cursor' parameter MUST specify the CBOR simple value "null" in case there are currently no TRL updates pertinent to the requester, i.e., the update collection for that requester is empty. This is the case from when the requester registers at the AS until a first update pertaining to that requester occurs to the TRL.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">Otherwise, the 'cursor' parameter MUST specify a CBOR unsigned integer. This MUST take the 'index' value of the last series item in the update collection associated with the requester (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>), as corresponding to the most recent update pertaining to the requester occurred to the TRL. Such a value is in fact the current value of 'last_index' for the update collection associated with the requester.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-using-cursor-diff-query-response">
<section id="section-8.2">
        <h3 id="name-response-to-diff-query">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-response-to-diff-query" class="section-name selfRef">Response to Diff Query</a>
        </h3>
<p id="section-8.2-1">When processing a diff query request to the TRL endpoint, the AS composes a response as defined in the following.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<div id="sec-using-cursor-diff-query-response-empty">
<section id="section-8.2.1">
          <h4 id="name-empty-collection">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-empty-collection" class="section-name selfRef">Empty Collection</a>
          </h4>
<p id="section-8.2.1-1">If the update collection associated with the requester has no elements, the AS returns a 2.05 (Content) response. The response MUST have Content-Format "application/ace-trl+cbor" and its payload MUST be a CBOR map formatted as follows.<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.1-2.1">
              <p id="section-8.2.1-2.1.1">The 'diff_set' parameter MUST be included and specifies the empty CBOR array.<a href="#section-8.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.1-2.2">
              <p id="section-8.2.1-2.2.1">The 'cursor' parameter MUST be included and specifies the CBOR simple value "null" (0xf6).<a href="#section-8.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.1-2.3">
              <p id="section-8.2.1-2.3.1">The 'more' parameter MUST be included and specifies the CBOR simple value "false" (0xf4).<a href="#section-8.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-8.2.1-3">Note that the above applies when the update collection associated with the requester has no elements, regardless of whether the 'cursor' query parameter is included or not in the diff query request, and irrespective of the specified unsigned integer value if present.<a href="#section-8.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-using-cursor-diff-query-response-no-cursor">
<section id="section-8.2.2">
          <h4 id="name-cursor-not-specified-in-the">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-cursor-not-specified-in-the" class="section-name selfRef">Cursor Not Specified in the Diff Query Request</a>
          </h4>
<p id="section-8.2.2-1">If the update collection associated with the requester is not empty and the diff query request does not include the 'cursor' query parameter, the AS performs the same actions defined in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>, with the following differences.<a href="#section-8.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.2-2.1">
              <p id="section-8.2.2-2.1.1">At step 3, the AS considers the value MAX_DIFF_BATCH (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>), and prepares L = min(U, MAX_DIFF_BATCH) diff entries.<a href="#section-8.2.2-2.1.1" class="pilcrow">¶</a></p>
<p id="section-8.2.2-2.1.2">
If U &lt;= MAX_DIFF_BATCH, the prepared diff entries are the last series items in the update collection associated with the requester, corresponding to the L most recent TRL updates pertaining to the requester.<a href="#section-8.2.2-2.1.2" class="pilcrow">¶</a></p>
<p id="section-8.2.2-2.1.3">
If U &gt; MAX_DIFF_BATCH, the prepared diff entries are the eldest of the last U series items in the update collection associated with the requester, as corresponding to the first L of the U most recent TRL updates pertaining to the requester.<a href="#section-8.2.2-2.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.2-2.2">
              <p id="section-8.2.2-2.2.1">At step 4, the CBOR map to carry in the payload of the 2.05 (Content) response MUST be formatted as follows.<a href="#section-8.2.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.2-2.2.2.1">
                  <p id="section-8.2.2-2.2.2.1.1">The 'diff_set' parameter MUST be present and specifies a CBOR array 'diff_set_value' of L elements. Each element of 'diff_set_value' specifies one of the CBOR arrays 'diff_entry' prepared as diff entry.<a href="#section-8.2.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-8.2.2-2.2.2.2">
                  <p id="section-8.2.2-2.2.2.2.1">The 'cursor' parameter MUST be present and specifies a CBOR unsigned integer. This MUST take the 'index' value of the series item of the update collection included as first diff entry in the 'diff_set_value' CBOR array, which is specified by the 'diff_set' parameter. That is, the 'cursor' parameter takes the 'index' value of the series item in the update collection corresponding to the most recent update pertaining to the requester and returned in this diff query response.<a href="#section-8.2.2-2.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-8.2.2-2.2.2.2.2">
Note that the 'cursor' parameter takes the same 'index' value of the last series item in the update collection when U &lt;= MAX_DIFF_BATCH.<a href="#section-8.2.2-2.2.2.2.2" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-8.2.2-2.2.2.3">
                  <p id="section-8.2.2-2.2.2.3.1">The 'more' parameter MUST be present and MUST specify the CBOR simple value "false" (0xf4) if U &lt;= MAX_DIFF_BATCH, or the CBOR simple value "true" (0xf5) otherwise.<a href="#section-8.2.2-2.2.2.3.1" class="pilcrow">¶</a></p>
<p id="section-8.2.2-2.2.2.3.2">
If the 'more' parameter has value "true", the requester can send a follow-up diff query request including the 'cursor' query parameter, with the same value of the 'cursor' parameter specified in this diff query response. As defined in <a href="#sec-using-cursor-diff-query-response-cursor" class="auto internal xref">Section 8.2.3</a>, this would result in the AS transferring the following subset of series items as diff entries, thus resuming from where interrupted in the previous transfer.<a href="#section-8.2.2-2.2.2.3.2" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="sec-using-cursor-diff-query-response-cursor">
<section id="section-8.2.3">
          <h4 id="name-cursor-specified-in-the-dif">
<a href="#section-8.2.3" class="section-number selfRef">8.2.3. </a><a href="#name-cursor-specified-in-the-dif" class="section-name selfRef">Cursor Specified in the Diff Query Request</a>
          </h4>
<p id="section-8.2.3-1">If the update collection associated with the requester is not empty and the diff query request includes the 'cursor' query parameter with value P, the AS proceeds as follows, depending on which of the following two cases hold.<a href="#section-8.2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.3-2.1">
              <p id="section-8.2.3-2.1.1">Case A - The series item X with 'index' having value P and the series item Y with 'index' having value (P + 1) % (MAX_INDEX + 1) are both not found in the update collection associated with the requester. This occurs when the item Y (and possibly further ones after it) has been previously removed from the history of updates for that requester (see step 5 at <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a>).<a href="#section-8.2.3-2.1.1" class="pilcrow">¶</a></p>
<p id="section-8.2.3-2.1.2">
In this case, the AS returns a 2.05 (Content) response. The response MUST have Content-Format "application/ace-trl+cbor" and its payload MUST be a CBOR map formatted as follows.<a href="#section-8.2.3-2.1.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.3-2.1.3.1">
                  <p id="section-8.2.3-2.1.3.1.1">The 'diff_set' parameter MUST be included and specifies the empty CBOR array.<a href="#section-8.2.3-2.1.3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-8.2.3-2.1.3.2">
                  <p id="section-8.2.3-2.1.3.2.1">The 'cursor' parameter MUST be included and specifies the CBOR simple value "null" (0xf6).<a href="#section-8.2.3-2.1.3.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-8.2.3-2.1.3.3">
                  <p id="section-8.2.3-2.1.3.3.1">The 'more' parameter MUST be included and specifies the CBOR simple value "true" (0xf5).<a href="#section-8.2.3-2.1.3.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-8.2.3-2.1.4">
With the combination ('cursor', 'more') = ("null", "true"), the AS is signaling that the update collection is in fact not empty, but that one or more series items have been lost due to their removal. These include the item with 'index' value (P + 1) % (MAX_INDEX + 1), that the requester wished to obtain as the first one following the specified reference point with 'index' value P.<a href="#section-8.2.3-2.1.4" class="pilcrow">¶</a></p>
<p id="section-8.2.3-2.1.5">
When receiving this diff query response, the requester should send a new full query request to the AS. A successful response provides the requester with the full, current pertaining subset of the TRL, as well as with a valid value of the 'cursor' parameter (see <a href="#sec-using-cursor-full-query-response" class="auto internal xref">Section 8.1</a>) to be possibly used as query parameter in a following diff query request.<a href="#section-8.2.3-2.1.5" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.3-2.2">
              <p id="section-8.2.3-2.2.1">Case B - The series item X with 'index' having value P is found in the update collection associated with the requester; or the series item X is not found and the series item Y with 'index' having value (P + 1) % (MAX_INDEX + 1) is found in the update collection associated with the requester.<a href="#section-8.2.3-2.2.1" class="pilcrow">¶</a></p>
<p id="section-8.2.3-2.2.2">
In this case, the AS performs the same actions defined in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>, with the following differences.<a href="#section-8.2.3-2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.3-2.2.3.1">
                  <p id="section-8.2.3-2.2.3.1.1">At step 3, the AS considers the value MAX_DIFF_BATCH (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>), and prepares L = min(SUB_U, MAX_DIFF_BATCH) diff entries, where SUB_U = min(NUM, SUB_SIZE), and SUB_SIZE is the number of series items in the update collection starting from and including the series item added immediately after X. If L is equal to 0 (e.g., because SUB_U is equal to 0), then no diff entries are prepared.<a href="#section-8.2.3-2.2.3.1.1" class="pilcrow">¶</a></p>
<p id="section-8.2.3-2.2.3.1.2">
If SUB_U &lt;= MAX_DIFF_BATCH, the prepared diff entries are the last series items in the update collection associated with the requester, corresponding to the L most recent TRL updates pertaining to the requester.<a href="#section-8.2.3-2.2.3.1.2" class="pilcrow">¶</a></p>
<p id="section-8.2.3-2.2.3.1.3">
If SUB_U &gt; MAX_DIFF_BATCH, the prepared diff entries are the eldest of the last SUB_U series items in the update collection associated with the requester, corresponding to the first L of the SUB_U most recent TRL updates pertaining to the requester.<a href="#section-8.2.3-2.2.3.1.3" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-8.2.3-2.2.3.2">
                  <p id="section-8.2.3-2.2.3.2.1">At step 4, the CBOR map to carry in the payload of the 2.05 (Content) response MUST be formatted as follows.<a href="#section-8.2.3-2.2.3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.3-2.2.3.2.2.1">
                      <p id="section-8.2.3-2.2.3.2.2.1.1">The 'diff_set' parameter MUST be present and specifies a CBOR array 'diff_set_value' of L elements. Each element of 'diff_set_value' specifies one of the CBOR arrays 'diff_entry' prepared as diff entry. Note that L might have value 0, in which case 'diff_set_value' is the empty CBOR array.<a href="#section-8.2.3-2.2.3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-8.2.3-2.2.3.2.2.2">
                      <p id="section-8.2.3-2.2.3.2.2.2.1">The 'cursor' parameter MUST be present and MUST specify a CBOR unsigned integer. In particular:<a href="#section-8.2.3-2.2.3.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.3-2.2.3.2.2.2.2.1">
                          <p id="section-8.2.3-2.2.3.2.2.2.2.1.1">If L is equal to 0, i.e., the series item X is the last one in the update collection, then the 'cursor' parameter MUST take the same 'index' value of the last series item in the update collection. Such a value is in fact the current value of 'last_index' for the update collection.<a href="#section-8.2.3-2.2.3.2.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                        <li class="normal" id="section-8.2.3-2.2.3.2.2.2.2.2">
                          <p id="section-8.2.3-2.2.3.2.2.2.2.2.1">If L is different than 0, then the 'cursor' parameter MUST take the 'index' value of the series element of the update collection included as first diff entry in the 'diff_set' CBOR array. That is, the 'cursor' parameter takes the 'index' value of the series item in the update collection corresponding to the most recent update pertaining to the requester and returned in this diff query response.<a href="#section-8.2.3-2.2.3.2.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                      </ul>
<p id="section-8.2.3-2.2.3.2.2.2.3">
Note that the 'cursor' parameter takes the same 'index' value of the last series item in the update collection when SUB_U &lt;= MAX_DIFF_BATCH.<a href="#section-8.2.3-2.2.3.2.2.2.3" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-8.2.3-2.2.3.2.2.3">
                      <p id="section-8.2.3-2.2.3.2.2.3.1">The 'more' parameter MUST be present and MUST specify the CBOR simple value "false" (0xf4) if SUB_U &lt;= MAX_DIFF_BATCH, or the CBOR simple value "true" (0xf5) otherwise.<a href="#section-8.2.3-2.2.3.2.2.3.1" class="pilcrow">¶</a></p>
<p id="section-8.2.3-2.2.3.2.2.3.2">
If 'more' has value "true", the requester can send a follow-up diff query request including the 'cursor' query parameter, with the same value of the 'cursor' parameter specified in this diff query response. This would result in the AS transferring the following subset of series items as diff entries, thus resuming from where interrupted in the previous transfer.<a href="#section-8.2.3-2.2.3.2.2.3.2" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-registration">
<section id="section-9">
      <h2 id="name-registration-at-the-authori">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-registration-at-the-authori" class="section-name selfRef">Registration at the Authorization Server</a>
      </h2>
<p id="section-9-1">During the registration process at the AS, an administrator or a registered device receives the following information as part of the registration response.<a href="#section-9-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9-2.1">
          <p id="section-9-2.1.1">The url-path to the TRL endpoint at the AS.<a href="#section-9-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-2.2">
          <p id="section-9-2.2.1">The hash function used to compute token hashes. This is specified as an integer or a text string, taking value from the "ID" or "Hash Name String" column of the "Named Information Hash Algorithm" Registry <span>[<a href="#Named.Information.Hash.Algorithm" class="cite xref">Named.Information.Hash.Algorithm</a>]</span>, respectively.<a href="#section-9-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-2.3">
          <p id="section-9-2.3.1">Optionally, a positive integer MAX_N, if the AS supports diff queries of the TRL (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a> and <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>).<a href="#section-9-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-2.4">
          <p id="section-9-2.4.1">Optionally, a positive integer MAX_DIFF_BATCH, if the AS supports diff queries of the TRL as well as the related "Cursor" extension (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a> and <a href="#sec-using-cursor" class="auto internal xref">Section 8</a>).<a href="#section-9-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-9-3">Further details about the registration process at the AS are out of scope for this specification. Note that the registration process is also out of the scope of the ACE framework for Authentication and Authorization (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.5" class="relref">Section 5.5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>).<a href="#section-9-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-notification">
<section id="section-10">
      <h2 id="name-notification-of-revoked-acc">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-notification-of-revoked-acc" class="section-name selfRef">Notification of Revoked Access Tokens</a>
      </h2>
<p id="section-10-1">Once registered at the AS, the administrator or registered device can send a GET request to the TRL endpoint at the AS. The request can express the wish for a full query (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>) or a diff query (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>) of the TRL. Also, the request can include the CoAP Observe Option set to 0 (register), in order to start an observation of the TRL endpoint as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">In case the request is successfully processed, the AS replies with a response specifying the CoAP response code 2.05 (Content). In particular, if the AS supports diff queries but not the "Cursor" extension (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a> and <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>), then the payload of the response is formatted as defined in <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a> or in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>, in case the GET request has yielded the execution of a full query or of a diff query of the TRL, respectively. Instead, if the AS supports both diff queries and the related "Cursor" extension, then the payload of the response is formatted as defined in <a href="#sec-using-cursor" class="auto internal xref">Section 8</a>.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">When the TRL is updated (see <a href="#ssec-trl-update" class="auto internal xref">Section 4.1</a>), the AS sends Observe notifications to the observers whose pertaining subset of the TRL has changed. Observe notifications are sent as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>. If supported by the AS, an observer may configure the behavior according to which the AS sends those Observe notifications. To this end, a possible way relies on the conditional control attribute "c.pmax" defined in <span>[<a href="#I-D.ietf-core-conditional-attributes" class="cite xref">I-D.ietf-core-conditional-attributes</a>]</span>, which can be included as a "name=value" query parameter in an Observation Request. This ensures that no more than c.pmax seconds elapse between two consecutive notifications sent to that observer, regardless of whether the TRL has changed or not.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">Following a first exchange with the AS, an administrator or a registered device can send additional GET (Observation) requests to the TRL endpoint at any time, analogously to what is defined above. When doing so, the requester towards the TRL endpoint can perform a full query (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>) or a diff query (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>) of the TRL.<a href="#section-10-4" class="pilcrow">¶</a></p>
<div id="handling-of-access-tokens-and-token-hashes">
<section id="section-10.1">
        <h3 id="name-handling-of-access-tokens-a">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-handling-of-access-tokens-a" class="section-name selfRef">Handling of Access Tokens and Token Hashes</a>
        </h3>
<p id="section-10.1-1">When receiving a response from the TRL endpoint, a registered device MUST expunge every stored access token associated with a token hash specified in the response. In case the registered device is an RS, it MUST store the token hash.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">An RS MUST NOT accept and store an access token, if the corresponding token hash is among the currently stored ones.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<p id="section-10.1-3">An RS stores a token hash th1 corresponding to an access token t1 until both the following conditions hold.<a href="#section-10.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.1-4.1">
            <p id="section-10.1-4.1.1">The RS has received and seen t1, irrespective of having accepted and stored it.<a href="#section-10.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-10.1-4.2">
            <p id="section-10.1-4.2.1">The RS has gained knowledge that t1 has expired. This can be achieved, e.g., through the following means.<a href="#section-10.1-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.1-4.2.2.1">
                <p id="section-10.1-4.2.2.1.1">A response from the TRL endpoint indicating that t1 has expired after its earlier revocation, i.e., the token hash th1 has been removed from the TRL. This can be indicated, for instance, in a response from the TRL endpoint following a diff query of the TRL (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>).<a href="#section-10.1-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.1-4.2.2.2">
                <p id="section-10.1-4.2.2.2.1">The value of the 'exp' claim specified in t1 indicates that t1 has expired.<a href="#section-10.1-4.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.1-4.2.2.3">
                <p id="section-10.1-4.2.2.3.1">The locally determined expiration time for t1 has passed, based on the time at the RS when t1 was first accepted and on the value of its 'exi' claim.<a href="#section-10.1-4.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.1-4.2.2.4">
                <p id="section-10.1-4.2.2.4.1">The result of token introspection performed on t1 (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), if supported by both the RS and the AS.<a href="#section-10.1-4.2.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-10.1-5">The RS MUST NOT delete the stored token hashes whose corresponding access tokens do not fulfill the two conditions above, unless it becomes necessary due to memory limitations. In such a case, the RS MUST delete the earliest stored token hashes first.<a href="#section-10.1-5" class="pilcrow">¶</a></p>
<p id="section-10.1-6">Retaining the stored token hashes as specified above limits the impact from a (dishonest) Client whose pertaining access token: i) specifies the 'exi' claim; ii) is uploaded at the RS for the first time after it has been revoked and later expired; and iii) has the sequence number encoded in the 'cti' claim greater than the highest sequence number among the expired access tokens specifying the 'exi' claim for the RS (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.3" class="relref">Section 5.10.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>). That is, the RS would not accept such a revoked and expired access token as long as it stores the corresponding token hash.<a href="#section-10.1-6" class="pilcrow">¶</a></p>
<p id="section-10.1-7">In order to further limit such a risk, when receiving an access token that specifies the 'exi' claim and for which a corresponding token hash is not stored, the RS can introspect the access token (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), if token introspection is implemented by both the RS and the AS.<a href="#section-10.1-7" class="pilcrow">¶</a></p>
<p id="section-10.1-8">When, due to the stored and corresponding token hash th2, an access token t2 that includes the 'exi' claim is expunged or is not accepted upon its upload, the RS retrieves the sequence number sn2 encoded in the 'cti' claim (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.3" class="relref">Section 5.10.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>). Then, the RS stores sn2 as associated with th2. If expunging or not accepting t2 yields the deletion of th2, then the RS MUST associate sn2 with th2 before continuing with the deletion of th2.<a href="#section-10.1-8" class="pilcrow">¶</a></p>
<p id="section-10.1-9">When deleting any token hash, the RS checks whether the token hash is associated with a sequence number sn_th. In such a case, the RS checks whether sn_th is greater than the highest sequence number sn* among the expired access tokens specifying the 'exi' claim for the RS. If that is the case, sn* MUST take the value of sn_th.<a href="#section-10.1-9" class="pilcrow">¶</a></p>
<p id="section-10.1-10">By virtue of what is defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.3" class="relref">Section 5.10.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, this ensures that, following the deletion of the token hash associated with an access token specifying the 'exi' claim and uploaded for the first time after it has been revoked and later expired, the RS will not accept the access token at that point in time or in the future.<a href="#section-10.1-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="trl-registry-parameters">
<section id="section-11">
      <h2 id="name-ace-token-revocation-list-p">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-ace-token-revocation-list-p" class="section-name selfRef">ACE Token Revocation List Parameters</a>
      </h2>
<p id="section-11-1">This specification defines a number of parameters that can be transported in the response from the TRL endpoint, when the response payload is a CBOR map. Note that such a response MUST use the Content-Format "application/ace-trl+cbor" defined in <a href="#iana-content-type" class="auto internal xref">Section 14.2</a> of this specification.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">The table below summarizes them, and specifies the CBOR value to use as abbreviation instead of the full descriptive name.<a href="#section-11-2" class="pilcrow">¶</a></p>
<span id="name-cbor-abbreviations-for-the-"></span><div id="fig-cbor-trl-params">
<figure id="figure-8">
        <div class="alignCenter art-text artwork" id="section-11-3.1">
<pre>
+-------------------+------------+------------------------+
| Name              | CBOR Value | CBOR Type              |
+-------------------+------------+------------------------+
| full_set          |  0         | array                  |
+-------------------+------------+------------------------+
| diff_set          |  1         | array                  |
+-------------------+------------+------------------------+
| cursor            |  2         | unsigned integer /     |
|                   |            | simple value "null"    |
+-------------------+------------+------------------------+
| more              |  3         | simple value "false" / |
|                   |            | simple value "true"    |
+-------------------+------------+------------------------+
| error             |  4         | integer                |
+-------------------+------------+------------------------+
| error_description |  5         | text string            |
+-------------------+------------+------------------------+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-cbor-abbreviations-for-the-" class="selfRef">CBOR abbreviations for the ACE Token Revocation List parameters</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="error-types">
<section id="section-12">
      <h2 id="name-ace-token-revocation-list-e">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-ace-token-revocation-list-e" class="section-name selfRef">ACE Token Revocation List Error Identifiers</a>
      </h2>
<p id="section-12-1">This specification defines a number of values that the AS can include as error identifiers, in the 'error' parameter of an error response from the TRL endpoint. This applies to error responses whose payload is a CBOR map and whose Content-Format is "application/ace-trl+cbor".<a href="#section-12-1" class="pilcrow">¶</a></p>
<span id="name-ace-token-revocation-list-er"></span><div id="fig-ACE-TRL-Error">
<figure id="figure-9">
        <div class="alignCenter art-text artwork" id="section-12-2.1">
<pre>
+-------+---------------------------+
| Value | Description               |
+-------+---------------------------+
|   0   | Invalid parameter value   |
+-------+---------------------------+
|   1   | Invalid set of parameters |
+-------+---------------------------+
|   2   | Out of bound cursor value |
+-------+---------------------------+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-ace-token-revocation-list-er" class="selfRef">ACE Token Revocation List Error Identifiers</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-security-considerations">
<section id="section-13">
      <h2 id="name-security-considerations">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-13-1">Security considerations are inherited from the ACE framework for Authentication and Authorization <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, from <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span> as to the usage of CWTs, from <span>[<a href="#RFC7519" class="cite xref">RFC7519</a>]</span> as to the usage of JWTs, from <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> as to the usage of CoAP Observe, and from <span>[<a href="#RFC6920" class="cite xref">RFC6920</a>]</span> with regard to computing the token hashes. The following considerations also apply.<a href="#section-13-1" class="pilcrow">¶</a></p>
<div id="content-retrieval-from-the-trl">
<section id="section-13.1">
        <h3 id="name-content-retrieval-from-the-">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-content-retrieval-from-the-" class="section-name selfRef">Content Retrieval from the TRL</a>
        </h3>
<p id="section-13.1-1">The AS MUST ensure that each registered device can access and retrieve only its pertaining subset of the TRL. To this end, the AS can perform the required filtering based on the authenticated identity of the registered device, i.e., a (non-public) identifier that the AS can securely relate to the registered device and the secure association that they use to communicate.<a href="#section-13.1-1" class="pilcrow">¶</a></p>
<p id="section-13.1-2">Disclosing any information about revoked access tokens to entities other than the intended registered devices may result in privacy concerns. Therefore, the AS MUST ensure that, other than registered devices accessing their own pertaining subset of the TRL, only authorized and authenticated administrators can retrieve the full TRL. To this end, the AS may rely on an access control list or similar.<a href="#section-13.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="size-of-the-trl">
<section id="section-13.2">
        <h3 id="name-size-of-the-trl">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-size-of-the-trl" class="section-name selfRef">Size of the TRL</a>
        </h3>
<p id="section-13.2-1">If many non-expired access tokens associated with a registered device are revoked, the pertaining subset of the TRL could grow to a size bigger than what the registered device is prepared to handle upon reception, especially if relying on a full query of the TRL (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a>).<a href="#section-13.2-1" class="pilcrow">¶</a></p>
<p id="section-13.2-2">This could be exploited by attackers to negatively affect the behavior of a registered device. Issuing access tokens with not too long expiration time could help reduce the size of the TRL, but an AS SHOULD take measures to limit this size.<a href="#section-13.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="communication-patterns">
<section id="section-13.3">
        <h3 id="name-communication-patterns">
<a href="#section-13.3" class="section-number selfRef">13.3. </a><a href="#name-communication-patterns" class="section-name selfRef">Communication Patterns</a>
        </h3>
<p id="section-13.3-1">The communication about revoked access tokens presented in this specification is expected to especially rely on CoAP Observe notifications sent from the AS to a registered device. The suppression of those notifications by an external attacker that has access to the network would prevent registered devices from ever knowing that their pertaining access tokens have been revoked.<a href="#section-13.3-1" class="pilcrow">¶</a></p>
<p id="section-13.3-2">In order to avoid this, a registered device SHOULD NOT rely solely on the CoAP Observe notifications. In particular, a registered device SHOULD also regularly poll the AS for the most current information about revoked access tokens, by sending GET requests to the TRL endpoint according to a related application policy.<a href="#section-13.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-of-new-access-tokens">
<section id="section-13.4">
        <h3 id="name-request-of-new-access-token">
<a href="#section-13.4" class="section-number selfRef">13.4. </a><a href="#name-request-of-new-access-token" class="section-name selfRef">Request of New Access Tokens</a>
        </h3>
<p id="section-13.4-1">If a Client stores an access token that it still believes to be valid, and it accordingly attempts to access a protected resource at the RS, the Client might anyway receive an unprotected 4.01 (Unauthorized) response from the RS.<a href="#section-13.4-1" class="pilcrow">¶</a></p>
<p id="section-13.4-2">This can be due to different reasons. For example, the access token has actually been revoked and the Client is not aware about that yet, while the RS has gained knowledge about that and has expunged the access token. Also, an on-path, active adversary might have injected a forged 4.01 (Unauthorized) response.<a href="#section-13.4-2" class="pilcrow">¶</a></p>
<p id="section-13.4-3">In either case, if the Client believes that the access token is still valid, it SHOULD NOT immediately ask for a new access token to the Authorization Server upon receiving a 4.01 (Unauthorized) response from the RS. Instead, the Client SHOULD send a request to the TRL endpoint at the AS. If the Client gains knowledge that the access token is not valid anymore, the Client expunges the access token and can ask for a new one. Otherwise, the Client can try again to upload the same access token to the RS, or instead to request a new one.<a href="#section-13.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dishonest-clients">
<section id="section-13.5">
        <h3 id="name-dishonest-clients">
<a href="#section-13.5" class="section-number selfRef">13.5. </a><a href="#name-dishonest-clients" class="section-name selfRef">Dishonest Clients</a>
        </h3>
<p id="section-13.5-1">A dishonest Client may attempt to exploit its early knowledge about a revoked access token, in order to illegitimately continue accessing a protected resource at the RS beyond the access token revocation.<a href="#section-13.5-1" class="pilcrow">¶</a></p>
<p id="section-13.5-2">That is, the Client might gain knowledge about the revocation of an access token considerably earlier than the RS, e.g., if the Client relies on CoAP Observe to access the TRL at the AS, while the RS relies only on polling through individual requests.<a href="#section-13.5-2" class="pilcrow">¶</a></p>
<p id="section-13.5-3">This makes the RS vulnerable during a time interval that starts when the Client gains knowledge of the revoked access token and ends when the RS expunges the access token, e.g., after having gained knowledge of its revocation. During such a time interval, the Client would be able to illegitimately access protected resources at the RS, if this still retains the access token without knowing about its revocation yet.<a href="#section-13.5-3" class="pilcrow">¶</a></p>
<p id="section-13.5-4">In order to mitigate the risk of such an abuse, if an RS relies solely on polling through individual requests to the TRL endpoint, the RS SHOULD enforce an adequate trade-off between the polling frequency and the maximum length of the vulnerable time window.<a href="#section-13.5-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-14">
      <h2 id="name-iana-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-14-1">This document has the following actions for IANA.<a href="#section-14-1" class="pilcrow">¶</a></p>
<p id="section-14-2">Note to RFC Editor: Please replace all occurrences of "[RFC-XXXX]" with the RFC number of this specification and delete this paragraph.<a href="#section-14-2" class="pilcrow">¶</a></p>
<div id="iana-media-type">
<section id="section-14.1">
        <h3 id="name-media-type-registrations">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-media-type-registrations" class="section-name selfRef">Media Type Registrations</a>
        </h3>
<p id="section-14.1-1">IANA is asked to register the media type "application/ace-trl+cbor" for messages of the protocol defined in this document encoded in CBOR. This registration follows the procedures specified in <span>[<a href="#RFC6838" class="cite xref">RFC6838</a>]</span>.<a href="#section-14.1-1" class="pilcrow">¶</a></p>
<p id="section-14.1-2">Type name: application<a href="#section-14.1-2" class="pilcrow">¶</a></p>
<p id="section-14.1-3">Subtype name: ace-trl+cbor<a href="#section-14.1-3" class="pilcrow">¶</a></p>
<p id="section-14.1-4">Required parameters: N/A<a href="#section-14.1-4" class="pilcrow">¶</a></p>
<p id="section-14.1-5">Optional parameters: N/A<a href="#section-14.1-5" class="pilcrow">¶</a></p>
<p id="section-14.1-6">Encoding considerations: Must be encoded as a CBOR map containing the protocol parameters defined in [RFC-XXXX].<a href="#section-14.1-6" class="pilcrow">¶</a></p>
<p id="section-14.1-7">Security considerations: See <a href="#sec-security-considerations" class="auto internal xref">Section 13</a> of this document.<a href="#section-14.1-7" class="pilcrow">¶</a></p>
<p id="section-14.1-8">Interoperability considerations: N/A<a href="#section-14.1-8" class="pilcrow">¶</a></p>
<p id="section-14.1-9">Published specification: [RFC-XXXX]<a href="#section-14.1-9" class="pilcrow">¶</a></p>
<p id="section-14.1-10">Applications that use this media type: The type is used by Authorization Servers, Clients and Resource Servers that support the notification of revoked access tokens, according to a Token Revocation List maintained by the Authorization Server as specified in [RFC-XXXX].<a href="#section-14.1-10" class="pilcrow">¶</a></p>
<p id="section-14.1-11">Fragment identifier considerations: N/A<a href="#section-14.1-11" class="pilcrow">¶</a></p>
<p id="section-14.1-12">Additional information: N/A<a href="#section-14.1-12" class="pilcrow">¶</a></p>
<p id="section-14.1-13">Person &amp; email address to contact for further information: &lt;iesg@ietf.org&gt;<a href="#section-14.1-13" class="pilcrow">¶</a></p>
<p id="section-14.1-14">Intended usage: COMMON<a href="#section-14.1-14" class="pilcrow">¶</a></p>
<p id="section-14.1-15">Restrictions on usage: None<a href="#section-14.1-15" class="pilcrow">¶</a></p>
<p id="section-14.1-16">Author: Marco Tiloca &lt;marco.tiloca@ri.se&gt;<a href="#section-14.1-16" class="pilcrow">¶</a></p>
<p id="section-14.1-17">Change controller: IESG<a href="#section-14.1-17" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-content-type">
<section id="section-14.2">
        <h3 id="name-coap-content-formats-regist">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-coap-content-formats-regist" class="section-name selfRef">CoAP Content-Formats Registry</a>
        </h3>
<p id="section-14.2-1">IANA is asked to add the following entry to the "CoAP Content-Formats" registry within the "CoRE Parameters" registry group.<a href="#section-14.2-1" class="pilcrow">¶</a></p>
<p id="section-14.2-2">Media Type: application/ace-trl+cbor<a href="#section-14.2-2" class="pilcrow">¶</a></p>
<p id="section-14.2-3">Encoding: -<a href="#section-14.2-3" class="pilcrow">¶</a></p>
<p id="section-14.2-4">ID: TBD<a href="#section-14.2-4" class="pilcrow">¶</a></p>
<p id="section-14.2-5">Reference: [RFC-XXXX]<a href="#section-14.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-token-revocation-list">
<section id="section-14.3">
        <h3 id="name-ace-token-revocation-list-pa">
<a href="#section-14.3" class="section-number selfRef">14.3. </a><a href="#name-ace-token-revocation-list-pa" class="section-name selfRef">ACE Token Revocation List Parameters Registry</a>
        </h3>
<p id="section-14.3-1">IANA is asked to establish the "ACE Token Revocation List Parameters" IANA registry within the "Authentication and Authorization for Constrained Environments (ACE)" registry group.<a href="#section-14.3-1" class="pilcrow">¶</a></p>
<p id="section-14.3-2">The registry uses the "Expert Review" registration procedure <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Expert Review guidelines are provided in <a href="#review" class="auto internal xref">Section 14.5</a>. It should be noted that, in addition to the Expert Review, some portions of the registry require a specification, potentially a Standards Track RFC, to be supplied as well.<a href="#section-14.3-2" class="pilcrow">¶</a></p>
<p id="section-14.3-3">The columns of this registry are:<a href="#section-14.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.3-4.1">
            <p id="section-14.3-4.1.1">Name: This field contains a descriptive name that enables easier reference to the item. The name MUST be unique. It is not used in the encoding.<a href="#section-14.3-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.3-4.2">
            <p id="section-14.3-4.2.1">CBOR Value: This field contains the value used as CBOR abbreviation of the item. These values MUST be unique. The value can be an unsigned integer or a negative integer. Different ranges of values use different registration policies <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Integer values from -256 to 255 are designated as "Standards Action With Expert Review". Integer values from -65536 to -257 and from 256 to 65535 are designated as "Specification Required". Integer values greater than 65535 are designated as "Expert Review". Integer values less than -65536 are marked as "Private Use".<a href="#section-14.3-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.3-4.3">
            <p id="section-14.3-4.3.1">CBOR Type: This field contains the CBOR type of the item, or a pointer to the registry that defines its type, when that depends on another item.<a href="#section-14.3-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.3-4.4">
            <p id="section-14.3-4.4.1">Reference: This field contains a pointer to the public specification for the item.<a href="#section-14.3-4.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-14.3-5">This registry has been initially populated by the values in <a href="#trl-registry-parameters" class="auto internal xref">Section 11</a>. The "Reference" column for all of these entries refers to this document.<a href="#section-14.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-token-revocation-list-errors">
<section id="section-14.4">
        <h3 id="name-ace-token-revocation-list-err">
<a href="#section-14.4" class="section-number selfRef">14.4. </a><a href="#name-ace-token-revocation-list-err" class="section-name selfRef">ACE Token Revocation List Errors</a>
        </h3>
<p id="section-14.4-1">IANA is asked to establish the "ACE Token Revocation List Errors" IANA registry within the "Authentication and Authorization for Constrained Environments (ACE)" registry group.<a href="#section-14.4-1" class="pilcrow">¶</a></p>
<p id="section-14.4-2">The registry uses the "Expert Review" registration procedure <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Expert Review guidelines are provided in <a href="#review" class="auto internal xref">Section 14.5</a>. It should be noted that, in addition to the Expert Review, some portions of the registry require a specification, potentially a Standards Track RFC, to be supplied as well.<a href="#section-14.4-2" class="pilcrow">¶</a></p>
<p id="section-14.4-3">The columns of this registry are:<a href="#section-14.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.4-4.1">
            <p id="section-14.4-4.1.1">Value: The field contains the value to be used to identify the error. These values MUST be unique. The value can be an unsigned integer or a negative integer. Different ranges of values use different registration policies <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Integer values from -256 to 255 are designated as "Standards Action With Expert Review". Integer values from -65536 to -257 and from 256 to 65535 are designated as "Specification Required". Integer values greater than 65535 are designated as "Expert Review". Integer values less than -65536 are marked as "Private Use".<a href="#section-14.4-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.4-4.2">
            <p id="section-14.4-4.2.1">Description: This field contains a brief description of the error.<a href="#section-14.4-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.4-4.3">
            <p id="section-14.4-4.3.1">Reference: This field contains a pointer to the public specification defining the error, if one exists.<a href="#section-14.4-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-14.4-5">This registry has been initially populated by the values in <a href="#error-types" class="auto internal xref">Section 12</a>. The "Reference" column for all of these entries refers to this document.<a href="#section-14.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="review">
<section id="section-14.5">
        <h3 id="name-expert-review-instructions">
<a href="#section-14.5" class="section-number selfRef">14.5. </a><a href="#name-expert-review-instructions" class="section-name selfRef">Expert Review Instructions</a>
        </h3>
<p id="section-14.5-1">The IANA registries established in this document are defined as "Expert Review". This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason so they should be given substantial latitude.<a href="#section-14.5-1" class="pilcrow">¶</a></p>
<p id="section-14.5-2">Expert reviewers should take into consideration the following points:<a href="#section-14.5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.5-3.1">
            <p id="section-14.5-3.1.1">Point squatting should be discouraged. Reviewers are encouraged to get sufficient information for registration requests to ensure that the usage is not going to duplicate one that is already registered and that the point is likely to be used in deployments. The zones tagged as private use are intended for testing purposes and closed environments. Code points in other ranges should not be assigned for testing.<a href="#section-14.5-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.5-3.2">
            <p id="section-14.5-3.2.1">Specifications are required for the "Standards Action With Expert Review" range of point assignment. Specifications should exist for "Specification Required" ranges, but early assignment before a specification is available is considered to be permissible. For the "Expert Review" range of point assignment, specifications are recommended, and are needed if they are expected to be used outside of closed environments in an interoperable way. When specifications are not provided, the description provided needs to have sufficient information to identify what the point is being used for.<a href="#section-14.5-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.5-3.3">
            <p id="section-14.5-3.3.1">Experts should take into account the expected usage of fields when approving point assignment. The fact that there is a range for Standards Track documents does not mean that a Standards Track document cannot have points assigned outside of that range. The length of the encoded value should be weighed against how many code points of that length are left, the size of device it will be used on, and the number of code points left that encode to that size.<a href="#section-14.5-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-15">
      <h2 id="name-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-15.1">
        <h3 id="name-normative-references">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="Named.Information.Hash.Algorithm">[Named.Information.Hash.Algorithm]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Named Information Hash Algorithm"</span>, <span>&lt;<a href="https://www.iana.org/assignments/named-information/named-information.xhtml">https://www.iana.org/assignments/named-information/named-information.xhtml</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6749">https://www.rfc-editor.org/rfc/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6838">[RFC6838]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span>, <span class="refAuthor">Klensin, J.</span>, and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"Media Type Specifications and Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 6838</span>, <span class="seriesInfo">DOI 10.17487/RFC6838</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6838">https://www.rfc-editor.org/rfc/rfc6838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6920">[RFC6920]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Kutscher, D.</span>, <span class="refAuthor">Dannewitz, C.</span>, <span class="refAuthor">Ohlman, B.</span>, <span class="refAuthor">Keranen, A.</span>, and <span class="refAuthor">P. Hallam-Baker</span>, <span class="refTitle">"Naming Things with Hashes"</span>, <span class="seriesInfo">RFC 6920</span>, <span class="seriesInfo">DOI 10.17487/RFC6920</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6920">https://www.rfc-editor.org/rfc/rfc6920</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7519">[RFC7519]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Token (JWT)"</span>, <span class="seriesInfo">RFC 7519</span>, <span class="seriesInfo">DOI 10.17487/RFC7519</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7519">https://www.rfc-editor.org/rfc/rfc7519</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7641">https://www.rfc-editor.org/rfc/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8126">https://www.rfc-editor.org/rfc/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8259">[RFC8259]</dt>
        <dd>
<span class="refAuthor">Bray, T., Ed.</span>, <span class="refTitle">"The JavaScript Object Notation (JSON) Data Interchange Format"</span>, <span class="seriesInfo">STD 90</span>, <span class="seriesInfo">RFC 8259</span>, <span class="seriesInfo">DOI 10.17487/RFC8259</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8392">https://www.rfc-editor.org/rfc/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9200">[RFC9200]</dt>
      <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments Using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="seriesInfo">RFC 9200</span>, <span class="seriesInfo">DOI 10.17487/RFC9200</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9200">https://www.rfc-editor.org/rfc/rfc9200</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-15.2">
        <h3 id="name-informative-references">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.bormann-t2trg-stp">[I-D.bormann-t2trg-stp]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">K. Hartke</span>, <span class="refTitle">"The Series Transfer Pattern (STP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bormann-t2trg-stp-03</span>, <time datetime="2020-04-07" class="refDate">7 April 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03">https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-conditional-attributes">[I-D.ietf-core-conditional-attributes]</dt>
        <dd>
<span class="refAuthor">Koster, M.</span>, <span class="refAuthor">Soloway, A.</span>, and <span class="refAuthor">B. Silverajan</span>, <span class="refTitle">"Conditional Attributes for Constrained RESTful Environments"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-conditional-attributes-06</span>, <time datetime="2023-01-14" class="refDate">14 January 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-conditional-attributes-06">https://datatracker.ietf.org/doc/html/draft-ietf-core-conditional-attributes-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7009">[RFC7009]</dt>
      <dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span>, <span class="refAuthor">Dronia, S.</span>, and <span class="refAuthor">M. Scurtescu</span>, <span class="refTitle">"OAuth 2.0 Token Revocation"</span>, <span class="seriesInfo">RFC 7009</span>, <span class="seriesInfo">DOI 10.17487/RFC7009</span>, <time datetime="2013-08" class="refDate">August 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7009">https://www.rfc-editor.org/rfc/rfc7009</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="sec-series-pattern">
<section id="appendix-A">
      <h2 id="name-on-using-the-series-transfe">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-on-using-the-series-transfe" class="section-name selfRef">On using the Series Transfer Pattern</a>
      </h2>
<p id="appendix-A-1">Performing a diff query of the TRL as specified in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a> is in fact a usage example of the Series Transfer Pattern defined in <span>[<a href="#I-D.bormann-t2trg-stp" class="cite xref">I-D.bormann-t2trg-stp</a>]</span>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">That is, a diff query enables the transfer of a series of TRL updates, with the AS specifying U &lt;= MAX_N diff entries as the U most recent updates to the subset of the TRL pertaining to a requester, i.e., a registered device or an administrator.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">When responding to a diff query request from a requester (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>), 'diff_set' is a subset of the update collection associated with the requester, where each 'diff_entry' record is a series item from that update collection. Note that 'diff_set' specifies the whole current update collection when the value of U is equal to SIZE, i.e., the current number of series items in the update collection.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">The value N of the 'diff' query parameter in the GET request allows the requester and the AS to trade the amount of provided information with the latency of the information transfer.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">Since the update collection associated with each requester includes up to MAX_N series items, the AS deletes the oldest series item when a new one is generated and added to the end of the update collection, due to a new TRL update pertaining to that requester (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a>). This addresses the question "When can the server decide to no longer retain older items?" raised in <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.bormann-t2trg-stp" class="cite xref">I-D.bormann-t2trg-stp</a>]</span>.<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<p id="appendix-A-6">Furthermore, performing a diff query of the TRL together with the "Cursor" extension as specified in <a href="#sec-using-cursor" class="auto internal xref">Section 8</a> in fact relies on the "Cursor" pattern of the Series Transfer Pattern (see <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03#section-3.3" class="relref">Section 3.3</a> of [<a href="#I-D.bormann-t2trg-stp" class="cite xref">I-D.bormann-t2trg-stp</a>]</span>).<a href="#appendix-A-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-trl-parameteters">
<section id="appendix-B">
      <h2 id="name-parameters-of-the-trl-endpo">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-parameters-of-the-trl-endpo" class="section-name selfRef">Parameters of the TRL Endpoint</a>
      </h2>
<p id="appendix-B-1"><a href="#fig-TRL-endpoint-parameters" class="auto internal xref">Figure 10</a> provides an aggregated overview of the parameters used by the TRL endpoint, when the AS supports diff queries (see <a href="#sec-trl-endpoint" class="auto internal xref">Section 5</a>) and the "Cursor" extension (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a>).<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">Except for MAX_N defined in <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 5.1</a>, all the other parameters are defined in <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 5.1.1</a> and are used only if the AS supports the "Cursor" extension.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<p id="appendix-B-3">For each parameter, the columns of the table specify the following information. Both a registered device and an administrator are referred to as "requester".<a href="#appendix-B-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-4.1">
          <p id="appendix-B-4.1.1">Name: parameter name. A name with letters in uppercase denotes a parameter whose value does not change after its initialization.<a href="#appendix-B-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-4.2">
          <p id="appendix-B-4.2.1">Single instance: "Y", if there is a single parameter instance associated with the TRL; or "N", if there is one parameter instance per update collection (i.e., per requester).<a href="#appendix-B-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-4.3">
          <p id="appendix-B-4.3.1">Description: short parameter description.<a href="#appendix-B-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-4.4">
          <p id="appendix-B-4.4.1">Values: the unsigned integer values that the parameter can assume, where LB and UB denote the inclusive lower bound and upper bound, respectively, and "^" is the exponentiation operator.<a href="#appendix-B-4.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<span id="name-parameters-of-the-trl-endpoi"></span><div id="fig-TRL-endpoint-parameters">
<figure id="figure-10">
        <div class="alignCenter art-text artwork" id="appendix-B-5.1">
<pre>
+----------------+----------+--------------------+--------------------+
| Name           | Single   | Description        | Value              |
|                | instance |                    |                    |
+----------------+----------+--------------------+--------------------+
| MAX_N          | Y        | Max number of TRL  | LB = 1             |
|                |          | updates stored per |                    |
|                |          | requester          | If supporting      |
|                |          |                    | "Cursor", then     |
|                |          |                    | UB = (MAX_INDEX+1) |
+----------------+----------+--------------------+--------------------+
| MAX_DIFF_BATCH | N        | Max number of diff | LB = 1             |
|                |          | entries included   |                    |
|                |          | in a diff query    | UB = MAX_N         |
|                |          | response when      |                    |
|                |          | using "Cursor"     |                    |
+----------------+----------+--------------------+--------------------+
| MAX_INDEX      | Y        | Max value of each  | LB = (MAX_N-1)     |
|                |          | instance of the    |                    |
|                |          | 'index' parameter  | UB = ((2^64)-1)    |
+----------------+----------+--------------------+--------------------+
| index          | N        | Value associated   | LB = 0             |
|                |          | with a series item |                    |
|                |          | of an updated      | UB = MAX_INDEX     |
|                |          | collection         |                    |
+----------------+----------+--------------------+--------------------+
| last_index     | N        | The 'index' value  | LB = 0             |
|                |          | of the most        |                    |
|                |          | recently added     | UB = MAX_INDEX     |
|                |          | series item in an  |                    |
|                |          | update collection  |                    |
+----------------+----------+--------------------+--------------------+
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-parameters-of-the-trl-endpoi" class="selfRef">Parameters of the TRL Endpoint</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-examples">
<section id="appendix-C">
      <h2 id="name-interaction-examples">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-interaction-examples" class="section-name selfRef">Interaction Examples</a>
      </h2>
<p id="appendix-C-1">This section provides examples of interactions between an RS as a registered device and an AS. In the examples, all the access tokens issued by the AS are intended to be consumed by the considered RS.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">The AS supports both full queries and diff queries of the TRL, as defined in <a href="#ssec-trl-full-query" class="auto internal xref">Section 6</a> and <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>, respectively.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
<p id="appendix-C-3">The details of the registration process are omitted, but it is assumed that the RS sends an unspecified payload to the AS, which replies with a 2.01 (Created) response.<a href="#appendix-C-3" class="pilcrow">¶</a></p>
<p id="appendix-C-4">The payload of the registration response is a CBOR map, which includes the following entries:<a href="#appendix-C-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-5.1">
          <p id="appendix-C-5.1.1">a 'trl_path' parameter, specifying the path of the TRL endpoint;<a href="#appendix-C-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-5.2">
          <p id="appendix-C-5.2.1">a 'trl_hash' parameter, specifying the hash function used to compute token hashes as defined in <a href="#sec-token-name" class="auto internal xref">Section 3</a>;<a href="#appendix-C-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-5.3">
          <p id="appendix-C-5.3.1">a 'max_n' parameter, specifying the value of MAX_N, i.e., the maximum number of TRL updates pertaining to each registered device that the AS retains for that device (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 7</a>);<a href="#appendix-C-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-5.4">
          <p id="appendix-C-5.4.1">possible further parameters related to the registration process.<a href="#appendix-C-5.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-C-6">Furthermore, 'h(x)' refers to the hash function used to compute the token hashes, as defined in <a href="#sec-token-name" class="auto internal xref">Section 3</a> of this specification and according to <span>[<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>. Assuming the usage of CWTs transported in CBOR, 'bstr.h(t1)' and 'bstr.h(t2)' denote the byte-string representations of the token hashes for the access tokens t1 and t2, respectively.<a href="#appendix-C-6" class="pilcrow">¶</a></p>
<div id="sec-RS-example-1">
<section id="appendix-C.1">
        <h3 id="name-full-query-with-observe">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-full-query-with-observe" class="section-name selfRef">Full Query with Observe</a>
        </h3>
<p id="appendix-C.1-1"><a href="#fig-RS-AS" class="auto internal xref">Figure 11</a> shows an interaction example considering a CoAP observation and a full query of the TRL.<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
<p id="appendix-C.1-2">In this example, the AS does not support the "Cursor" extension. Hence the 'cursor' parameter is not included in the payload of the responses to a full query request.<a href="#appendix-C.1-2" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-"></span><div id="fig-RS-AS">
<figure id="figure-11">
          <div class="alignCenter art-text artwork" id="appendix-C.1-3.1">
<pre>
RS                                                  AS
|                                                    |
|  Registration: POST                                |
+---------------------------------------------------&gt;|
|                                                    |
|&lt;---------------------------------------------------+
|                    2.01 CREATED                    |
|                      Payload: {                    |
|                        ...                         |
|                        "trl_path" : "revoke/trl",  |
|                        "trl_hash" : "sha-256",     |
|                           "max_n" : 10             |
|                      }                             |
|                                                    |
|  GET Observe: 0                                    |
|    coap://as.example.com/revoke/trl/               |
+---------------------------------------------------&gt;|
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 42                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : []                           |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|          (Access tokens t1 and t2 issued           |
|          and successfully submitted to RS)         |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|                                                    |
|             (Access token t1 is revoked)           |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 53                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : [bstr.h(t1)]                 |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|             (Access token t2 is revoked)           |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 64                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : [bstr.h(t1), bstr.h(t2)]     |
|        }                                           |
|                                                    |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|             (Access token t1 expires)              |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 75                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : [bstr.h(t2)]                 |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|             (Access token t2 expires)              |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 86                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : []                           |
|        }                                           |
|                                                    |
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-interaction-for-full-query-" class="selfRef">Interaction for Full Query with Observe</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-2">
<section id="appendix-C.2">
        <h3 id="name-diff-query-with-observe">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-diff-query-with-observe" class="section-name selfRef">Diff Query with Observe</a>
        </h3>
<p id="appendix-C.2-1"><a href="#fig-RS-AS-2" class="auto internal xref">Figure 12</a> shows an interaction example considering a CoAP observation and a diff query of the TRL.<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
<p id="appendix-C.2-2">The RS indicates N = 3 as value of the 'diff' query parameter, i.e., as the maximum number of diff entries to be specified in a response from the AS.<a href="#appendix-C.2-2" class="pilcrow">¶</a></p>
<p id="appendix-C.2-3">In this example, the AS does not support the "Cursor" extension. Hence the 'cursor' parameter and the 'more' parameter are not included in the payload of the responses to a diff query request.<a href="#appendix-C.2-3" class="pilcrow">¶</a></p>
<span id="name-interaction-for-diff-query-"></span><div id="fig-RS-AS-2">
<figure id="figure-12">
          <div class="alignCenter art-text artwork" id="appendix-C.2-4.1">
<pre>
RS                                                  AS
|                                                    |
|  Registration: POST                                |
+---------------------------------------------------&gt;|
|                                                    |
|&lt;---------------------------------------------------+
|                   2.01 CREATED                     |
|                     Payload: {                     |
|                       ...                          |
|                       "trl_path" : "revoke/trl",   |
|                       "trl_hash" : "sha-256",      |
|                          "max_n" : 10              |
|                     }                              |
|                                                    |
|  GET Observe: 0                                    |
|    coap://as.example.com/revoke/trl?diff=3         |
+---------------------------------------------------&gt;|
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 42                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "diff_set" : []                           |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|          (Access tokens t1 and t2 issued           |
|          and successfully submitted to RS)         |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|            (Access token t1 is revoked)            |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 53                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "diff_set" : [                            |
|                         [ [], [bstr.h(t1)] ]       |
|                       ]                            |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|            (Access token t2 is revoked)            |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 64                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "diff_set" : [                            |
|                         [ [], [bstr.h(t2)] ],      |
|                         [ [], [bstr.h(t1)] ]       |
|                       ]                            |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|              (Access token t1 expires)             |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 75                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "diff_set" : [                            |
|                         [ [bstr.h(t1)], [] ],      |
|                         [ [], [bstr.h(t2)] ],      |
|                         [ [], [bstr.h(t1)] ]       |
|                       ]                            |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|              (Access token t2 expires)             |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 86                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "diff_set" : [                            |
|                         [ [bstr.h(t2)], [] ],      |
|                         [ [bstr.h(t1)], [] ],      |
|                         [ [], [bstr.h(t2)] ]       |
|                       ]                            |
|        }                                           |
|                                                    |
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-interaction-for-diff-query-" class="selfRef">Interaction for Diff Query with Observe</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-3">
<section id="appendix-C.3">
        <h3 id="name-full-query-with-observe-plu">
<a href="#appendix-C.3" class="section-number selfRef">C.3. </a><a href="#name-full-query-with-observe-plu" class="section-name selfRef">Full Query with Observe plus Diff Query</a>
        </h3>
<p id="appendix-C.3-1"><a href="#fig-RS-AS-3" class="auto internal xref">Figure 13</a> shows an interaction example considering a CoAP observation and a full query of the TRL.<a href="#appendix-C.3-1" class="pilcrow">¶</a></p>
<p id="appendix-C.3-2">The example also considers one of the notifications from the AS to get lost in transmission, and thus not reaching the RS.<a href="#appendix-C.3-2" class="pilcrow">¶</a></p>
<p id="appendix-C.3-3">When this happens, and after a waiting time defined by the application has elapsed, the RS sends a GET request with no Observe Option to the AS, to perform a diff query of the TRL. The RS indicates N = 8 as value of the 'diff' query parameter, i.e., as the maximum number of diff entries to be specified in a response from the AS.<a href="#appendix-C.3-3" class="pilcrow">¶</a></p>
<p id="appendix-C.3-4">In this example, the AS does not support the "Cursor" extension. Hence, the 'cursor' parameter is not included in the payload of the responses to a full query request. Also, the 'cursor' parameter and the 'more' parameter are not included in the payload of the responses to a diff query request.<a href="#appendix-C.3-4" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-w"></span><div id="fig-RS-AS-3">
<figure id="figure-13">
          <div class="alignCenter art-text artwork" id="appendix-C.3-5.1">
<pre>
RS                                                  AS
|                                                    |
|  Registration: POST                                |
+---------------------------------------------------&gt;|
|                                                    |
|&lt;---------------------------------------------------+
|                   2.01 CREATED                     |
|                     Payload: {                     |
|                       ...                          |
|                       "trl_path" : "revoke/trl",   |
|                       "trl_hash" : "sha-256",      |
|                          "max_n" : 10              |
|                     }                              |
|                                                    |
|  GET Observe: 0                                    |
|    coap://as.example.com/revoke/trl/               |
+---------------------------------------------------&gt;|
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 42                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : []                           |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|          (Access tokens t1 and t2 issued           |
|          and successfully submitted to RS)         |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|            (Access token t1 is revoked)            |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 53                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : [bstr.h(t1)]                 |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|            (Access token t2 is revoked)            |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 64                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : [bstr.h(t1), bstr.h(t2)]     |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|             (Access token t1 expires)              |
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT Observe: 75                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : [bstr.h(t2)]                 |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|             (Access token t2 expires)              |
|                                                    |
|  X&lt;------------------------------------------------+
|      2.05 CONTENT Observe: 86                      |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "full_set" : []                           |
|        }                                           |
|                         .                          |
|                         .                          |
|                         .                          |
|                                                    |
|           (Enough time has passed since            |
|         the latest received notification)          |
|                                                    |
|  GET                                               |
|    coap://as.example.com/revoke/trl?diff=8         |
+---------------------------------------------------&gt;|
|                                                    |
|&lt;---------------------------------------------------+
|      2.05 CONTENT                                  |
|        Content-Format: "application/ace-trl+cbor"  |
|        Payload: {                                  |
|          "diff_set" : [                            |
|                         [ [bstr.h(t2)], [] ],      |
|                         [ [bstr.h(t1)], [] ],      |
|                         [ [], [bstr.h(t2)] ],      |
|                         [ [], [bstr.h(t1)] ]       |
|                       ]                            |
|        }                                           |
|                                                    |
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-interaction-for-full-query-w" class="selfRef">Interaction for Full Query with Observe plus Diff Query</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-2-3">
<section id="appendix-C.4">
        <h3 id="name-diff-query-with-observe-and">
<a href="#appendix-C.4" class="section-number selfRef">C.4. </a><a href="#name-diff-query-with-observe-and" class="section-name selfRef">Diff Query with Observe and "Cursor"</a>
        </h3>
<p id="appendix-C.4-1">In this example, the AS supports the "Cursor" extension. Hence, the CBOR map conveyed as payload of the registration response additionally includes a "max_diff_batch" parameter. This specifies the value of MAX_DIFF_BATCH, i.e., the maximum number of diff entries that can be included in a response to a diff query request from this RS.<a href="#appendix-C.4-1" class="pilcrow">¶</a></p>
<p id="appendix-C.4-2"><a href="#fig-RS-AS-4" class="auto internal xref">Figure 14</a> shows an interaction example considering a CoAP observation and a diff query of the TRL.<a href="#appendix-C.4-2" class="pilcrow">¶</a></p>
<p id="appendix-C.4-3">The RS specifies the query parameter 'diff' with value 3, i.e., the maximum number of diff entries to be specified in a response from the AS.<a href="#appendix-C.4-3" class="pilcrow">¶</a></p>
<p id="appendix-C.4-4">After the RS has not received a notification from the AS for a waiting time defined by the application, the RS sends a GET request with no Observe Option to the AS, to perform a diff query of the TRL.<a href="#appendix-C.4-4" class="pilcrow">¶</a></p>
<p id="appendix-C.4-5">This is followed up by a further diff query request that specifies the query parameter 'cursor'. Note that the payload of the corresponding response differs from the payload of the response to the previous diff query request.<a href="#appendix-C.4-5" class="pilcrow">¶</a></p>
<span id="name-interaction-for-diff-query-w"></span><div id="fig-RS-AS-4">
<figure id="figure-14">
          <div class="alignCenter art-text artwork" id="appendix-C.4-6.1">
<pre>
RS                                                      AS
|                                                        |
|  Registration: POST                                    |
+-------------------------------------------------------&gt;|
|                                                        |
|&lt;-------------------------------------------------------+
|                   2.01 CREATED                         |
|                     Payload: {                         |
|                            ...                         |
|                            "trl_path" : "revoke/trl",  |
|                            "trl_hash" : "sha-256",     |
|                               "max_n" : 10,            |
|                       "max_diff_batch": 5              |
|                     }                                  |
|                                                        |
|  GET Observe: 0                                        |
|    coap://as.example.com/revoke/trl?diff=3             |
+-------------------------------------------------------&gt;|
|                                                        |
|&lt;-------------------------------------------------------+
|          2.05 CONTENT Observe: 42                      |
|            Content-Format: "application/ace-trl+cbor"  |
|            Payload: {                                  |
|              "diff_set" : [],                          |
|                "cursor" : null,                        |
|                  "more" : false                        |
|            }                                           |
|                           .                            |
|                           .                            |
|                           .                            |
|                                                        |
|            (Access tokens t1 and t2 issued             |
|            and successfully submitted to RS)           |
|                           .                            |
|                           .                            |
|                           .                            |
|                                                        |
|              (Access token t1 is revoked)              |
|                                                        |
|&lt;-------------------------------------------------------+
|          2.05 CONTENT Observe: 53                      |
|            Content-Format: "application/ace-trl+cbor"  |
|            Payload: {                                  |
|              "diff_set" : [                            |
|                             [ [], [bstr.h(t1)] ]       |
|                           ],                           |
|                "cursor" : 0,                           |
|                  "more" : false                        |
|            }                                           |
|                           .                            |
|                           .                            |
|                           .                            |
|                                                        |
|              (Access token t2 is revoked)              |
|                                                        |
|&lt;-------------------------------------------------------+
|          2.05 CONTENT Observe: 64                      |
|            Content-Format: "application/ace-trl+cbor"  |
|            Payload: {                                  |
|              "diff_set" : [                            |
|                             [ [], [bstr.h(t2)] ],      |
|                             [ [], [bstr.h(t1)] ]       |
|                           ],                           |
|                "cursor" : 1,                           |
|                  "more" : false                        |
|            }                                           |
|                           .                            |
|                           .                            |
|                           .                            |
|                                                        |
|              (Access token t1 expires)                 |
|                                                        |
|&lt;-------------------------------------------------------+
|          2.05 CONTENT Observe: 75                      |
|            Content-Format: "application/ace-trl+cbor"  |
|            Payload: {                                  |
|              "diff_set" : [                            |
|                             [ [bstr.h(t1)], [] ],      |
|                             [ [], [bstr.h(t2)] ],      |
|                             [ [], [bstr.h(t1)] ]       |
|                           ],                           |
|                "cursor" : 2,                           |
|                  "more" : false                        |
|            }                                           |
|                           .                            |
|                           .                            |
|                           .                            |
|                                                        |
|              (Access token t2 expires)                 |
|                                                        |
|&lt;-------------------------------------------------------+
|          2.05 CONTENT Observe: 86                      |
|            Content-Format: "application/ace-trl+cbor"  |
|            Payload: {                                  |
|              "diff_set" : [                            |
|                             [ [bstr.h(t2)], [] ],      |
|                             [ [bstr.h(t1)], [] ],      |
|                             [ [], [bstr.h(t2)] ]       |
|                           ],                           |
|                "cursor" : 3,                           |
|                  "more" : false                        |
|            }                                           |
|                           .                            |
|                           .                            |
|                           .                            |
|                                                        |
|            (Enough time has passed since               |
|             the latest received notification)          |
|                                                        |
|  GET                                                   |
|    coap://as.example.com/revoke/trl?diff=3             |
+-------------------------------------------------------&gt;|
|                                                        |
|&lt;-------------------------------------------------------+
|          2.05 CONTENT                                  |
|            Content-Format: "application/ace-trl+cbor"  |
|            Payload: {                                  |
|              "diff_set" : [                            |
|                             [ [bstr.h(t2)], [] ],      |
|                             [ [bstr.h(t1)], [] ],      |
|                             [ [], [bstr.h(t2)] ]       |
|                           ],                           |
|                "cursor" : 3,                           |
|                  "more" : false                        |
|            }                                           |
|                                                        |
|  GET                                                   |
|    coap://as.example.com/revoke/trl?diff=3&amp;cursor=3    |
+-------------------------------------------------------&gt;|
|                                                        |
|&lt;-------------------------------------------------------+
|          2.05 CONTENT                                  |
|            Content-Format: "application/ace-trl+cbor"  |
|            Payload: {                                  |
|              "diff_set" : [],                          |
|                "cursor" : 3,                           |
|                  "more" : false                        |
|            }                                           |
|                                                        |
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-interaction-for-diff-query-w" class="selfRef">Interaction for Diff Query with Observe and "Cursor"</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-5">
<section id="appendix-C.5">
        <h3 id="name-full-query-with-observe-plus">
<a href="#appendix-C.5" class="section-number selfRef">C.5. </a><a href="#name-full-query-with-observe-plus" class="section-name selfRef">Full Query with Observe plus Diff Query with "Cursor"</a>
        </h3>
<p id="appendix-C.5-1">In this example, the AS supports the "Cursor" extension. Hence, the CBOR map conveyed as payload of the registration response additionally includes a "max_diff_batch" parameter. This specifies the value of MAX_DIFF_BATCH, i.e., the maximum number of diff entries that can be included in a response to a diff query request from this RS.<a href="#appendix-C.5-1" class="pilcrow">¶</a></p>
<p id="appendix-C.5-2"><a href="#fig-RS-AS-5" class="auto internal xref">Figure 15</a> shows an interaction example considering a CoAP observation and a full query of the TRL.<a href="#appendix-C.5-2" class="pilcrow">¶</a></p>
<p id="appendix-C.5-3">The example also considers some of the notifications from the AS to get lost in transmission, and thus not reaching the RS.<a href="#appendix-C.5-3" class="pilcrow">¶</a></p>
<p id="appendix-C.5-4">When this happens, and after a waiting time defined by the application has elapsed, the RS sends a GET request with no Observe Option to the AS, to perform a diff query of the TRL. In particular, the RS specifies:<a href="#appendix-C.5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.5-5.1">
            <p id="appendix-C.5-5.1.1">The query parameter 'diff' with value 8, i.e., the maximum number of diff entries to be specified in a response from the AS.<a href="#appendix-C.5-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.5-5.2">
            <p id="appendix-C.5-5.2.1">The query parameter 'cursor' with value 2, thus requesting from the update collection the series items following the one with 'index' value equal to 2 (i.e., following the last series item that the RS successfully received in an earlier notification response).<a href="#appendix-C.5-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.5-6">The response from the AS conveys a first batch of MAX_DIFF_BATCH=5 series items from the update collection corresponding to the RS. The AS indicates that further series items are actually available in the update collection, by setting the 'more' parameter of the response to "true". Also, the 'cursor' parameter of the response is set to 7, i.e., to the 'index' value of the most recent series item included in the response.<a href="#appendix-C.5-6" class="pilcrow">¶</a></p>
<p id="appendix-C.5-7">After that, the RS follows up with a further diff query request specifying the query parameter 'cursor' with value 7, in order to retrieve the next and last batch of series items from the update collection.<a href="#appendix-C.5-7" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-wi"></span><div id="fig-RS-AS-5">
<figure id="figure-15">
          <div class="alignCenter art-text artwork" id="appendix-C.5-8.1">
<pre>
RS                                                             AS
|                                                               |
|  Registration: POST                                           |
+--------------------------------------------------------------&gt;|
|                                                               |
|&lt;--------------------------------------------------------------+
|                          2.01 CREATED                         |
|                            Payload: {                         |
|                                   ...                         |
|                                   "trl_path" : "revoke/trl",  |
|                                   "trl_hash" : "sha-256",     |
|                                      "max_n" : 10,            |
|                              "max_diff_batch": 5              |
|                            }                                  |
|                                                               |
|  GET Observe: 0                                               |
|    coap://as.example.com/revoke/trl/                          |
+--------------------------------------------------------------&gt;|
|                                                               |
|&lt;--------------------------------------------------------------+
|                 2.05 CONTENT Observe: 42                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [],                          |
|                       "cursor" : null                         |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|               (Access tokens t1, t2, t3 issued                |
|                and successfully submitted to RS)              |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|               (Access tokens t4, t5, t6 issued                |
|               and successfully submitted to RS)               |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                  (Access token t1 is revoked)                 |
|                                                               |
|&lt;--------------------------------------------------------------+
|                 2.05 CONTENT Observe: 53                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t1)],                |
|                       "cursor" : 0                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                  (Access token t2 is revoked)                 |
|                                                               |
|&lt;--------------------------------------------------------------+
|                 2.05 CONTENT Observe: 64                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t1), bstr.h(t2)],    |
|                       "cursor" : 1                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                   (Access token t1 expires)                   |
|                                                               |
|&lt;--------------------------------------------------------------+
|                 2.05 CONTENT Observe: 75                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t2)],                |
|                     "cursor"   : 2                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                   (Access token t2 expires)                   |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 86                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [],                          |
|                       "cursor" : 3                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                  (Access token t3 is revoked)                 |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 88                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t3)],                |
|                       "cursor" : 4                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                  (Access token t4 is revoked)                 |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 89                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t3), bstr.h(t4)],    |
|                       "cursor" : 5                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                    (Access token t3 expires)                  |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 90                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t4)],                |
|                       "cursor" : 6                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                    (Access token t4 expires)                  |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 91                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [],                          |
|                       "cursor" : 7                            |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|              (Access tokens t5 and t6 are revoked)            |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 92                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t5), bstr.h(t6)],    |
|                     "cursor" : 8                              |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                    (Access token t5 expires)                  |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 93                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [bstr.h(t6)],                |
|                     "cursor" : 9                              |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                    (Access token t6 expires)                  |
|                                                               |
|  X&lt;-----------------------------------------------------------+
|                 2.05 CONTENT Observe: 94                      |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "full_set" : [],                          |
|                       "cursor" : 10                           |
|                   }                                           |
|                               .                               |
|                               .                               |
|                               .                               |
|                                                               |
|                (Enough time has passed since                  |
|                 the latest received notification)             |
|                                                               |
|  GET                                                          |
|    coap://as.example.com/revoke/trl?diff=8&amp;cursor=2           |
+--------------------------------------------------------------&gt;|
|                                                               |
|&lt;--------------------------------------------------------------+
|                 2.05 CONTENT                                  |
|                   Content-Format: "application/ace-trl+cbor"  |
|                   Payload: {                                  |
|                     "diff_set" : [                            |
|                                    [ [bstr.h(t4)], [] ],      |
|                                    [ [bstr.h(t3)], [] ],      |
|                                    [ [], [bstr.h(t4)] ],      |
|                                    [ [], [bstr.h(t3)] ],      |
|                                    [ [bstr.h(t2)], [] ]       |
|                                  ],                           |
|                       "cursor" : 7,                           |
|                         "more" : true                         |
|                   }                                           |
|                                                               |
|  GET                                                          |
|    coap://as.example.com/revoke/trl?diff=8&amp;cursor=7           |
+--------------------------------------------------------------&gt;|
|                                                               |
|&lt;--------------------------------------------------------------+
|        2.05 CONTENT                                           |
|          Content-Format: "application/ace-trl+cbor"           |
|          Payload: {                                           |
|            "diff_set" : [                                     |
|                           [ [bstr.h(t6)], [] ],               |
|                           [ [bstr.h(t5)], [] ],               |
|                           [ [], [bstr.h(t5), bstr.h(t6)] ]    |
|                         ],                                    |
|              "cursor" : 10,                                   |
|                "more" : false                                 |
|          }                                                    |
|                                                               |
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a>:
<a href="#name-interaction-for-full-query-wi" class="selfRef">Interaction for Full Query with Observe plus Diff Query with "Cursor"</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-D">
      <h2 id="name-document-updates">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-D-1">RFC EDITOR: Please remove this section.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<div id="sec-05-06">
<section id="appendix-D.1">
        <h3 id="name-version-05-to-06">
<a href="#appendix-D.1" class="section-number selfRef">D.1. </a><a href="#name-version-05-to-06" class="section-name selfRef">Version -05 to -06</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.1-1.1">
            <p id="appendix-D.1-1.1.1">Clarified instructions for Expert Review in the IANA considerations.<a href="#appendix-D.1-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-04-05">
<section id="appendix-D.2">
        <h3 id="name-version-04-to-05">
<a href="#appendix-D.2" class="section-number selfRef">D.2. </a><a href="#name-version-04-to-05" class="section-name selfRef">Version -04 to -05</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.2-1.1">
            <p id="appendix-D.2-1.1.1">Explicit focus on CoAP in the abstract and introduction.<a href="#appendix-D.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.2">
            <p id="appendix-D.2-1.2.1">Removed terminology aliasing ("TRL endpoint" vs. "TRL resource").<a href="#appendix-D.2-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.3">
            <p id="appendix-D.2-1.3.1">Use "requester" instead of "caller".<a href="#appendix-D.2-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.4">
            <p id="appendix-D.2-1.4.1">Use "subset" instead of "portion".<a href="#appendix-D.2-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.5">
            <p id="appendix-D.2-1.5.1">Revised presentation of how token hashes are computed.<a href="#appendix-D.2-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.6">
            <p id="appendix-D.2-1.6.1">Improved error handling.<a href="#appendix-D.2-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.7">
            <p id="appendix-D.2-1.7.1">Revised examples.<a href="#appendix-D.2-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.8">
            <p id="appendix-D.2-1.8.1">More precise security considerations.<a href="#appendix-D.2-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.9">
            <p id="appendix-D.2-1.9.1">Clarifications and editorial improvements.<a href="#appendix-D.2-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.10">
            <p id="appendix-D.2-1.10.1">Updated author list.<a href="#appendix-D.2-1.10.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-03-04">
<section id="appendix-D.3">
        <h3 id="name-version-03-to-04">
<a href="#appendix-D.3" class="section-number selfRef">D.3. </a><a href="#name-version-03-to-04" class="section-name selfRef">Version -03 to -04</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.3-1.1">
            <p id="appendix-D.3-1.1.1">Improved presentation of pre- and post-registration operations.<a href="#appendix-D.3-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.2">
            <p id="appendix-D.3-1.2.1">Removed moot processing cases with the "Cursor" extension.<a href="#appendix-D.3-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.3">
            <p id="appendix-D.3-1.3.1">Positive integers as CBOR abbreviations for all parameters.<a href="#appendix-D.3-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.4">
            <p id="appendix-D.3-1.4.1">Renamed N_MAX as MAX_N.<a href="#appendix-D.3-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.5">
            <p id="appendix-D.3-1.5.1">Access tokens are not necessarily uploaded through /authz-info.<a href="#appendix-D.3-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.6">
            <p id="appendix-D.3-1.6.1">The use of the "c.pmax" conditional attribute is just an example.<a href="#appendix-D.3-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.7">
            <p id="appendix-D.3-1.7.1">Revised handling of token hashes at the RS.<a href="#appendix-D.3-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.8">
            <p id="appendix-D.3-1.8.1">Extended and improved security considerations.<a href="#appendix-D.3-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.9">
            <p id="appendix-D.3-1.9.1">Fixed details in IANA considerations.<a href="#appendix-D.3-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.10">
            <p id="appendix-D.3-1.10.1">New appendix overviewing parameters of the TRL endpoint.<a href="#appendix-D.3-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.11">
            <p id="appendix-D.3-1.11.1">Examples of message exchange moved to an appendix.<a href="#appendix-D.3-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.12">
            <p id="appendix-D.3-1.12.1">Added examples of message exchange with the "Cursor" extension.<a href="#appendix-D.3-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.13">
            <p id="appendix-D.3-1.13.1">Clarifications and editorial improvements.<a href="#appendix-D.3-1.13.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-02-03">
<section id="appendix-D.4">
        <h3 id="name-version-02-to-03">
<a href="#appendix-D.4" class="section-number selfRef">D.4. </a><a href="#name-version-02-to-03" class="section-name selfRef">Version -02 to -03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.4-1.1">
            <p id="appendix-D.4-1.1.1">Definition of MAX_INDEX for the "Cursor" extension.<a href="#appendix-D.4-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.2">
            <p id="appendix-D.4-1.2.1">Handling wrap-around of 'index' when using the "Cursor" extension.<a href="#appendix-D.4-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.3">
            <p id="appendix-D.4-1.3.1">Error handling for the case where 'cursor' &gt; MAX_INDEX.<a href="#appendix-D.4-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.4">
            <p id="appendix-D.4-1.4.1">Improved error handling in case 'index' is out-of-bound.<a href="#appendix-D.4-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.5">
            <p id="appendix-D.4-1.5.1">Clarified parameter semantics, message content and examples.<a href="#appendix-D.4-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.6">
            <p id="appendix-D.4-1.6.1">Editorial improvements.<a href="#appendix-D.4-1.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-01-02">
<section id="appendix-D.5">
        <h3 id="name-version-01-to-02">
<a href="#appendix-D.5" class="section-number selfRef">D.5. </a><a href="#name-version-01-to-02" class="section-name selfRef">Version -01 to -02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.5-1.1">
            <p id="appendix-D.5-1.1.1">Earlier mentioning of error cases.<a href="#appendix-D.5-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.2">
            <p id="appendix-D.5-1.2.1">Clearer distinction between maintaining the history of TRL updates and preparing the response to a diff query.<a href="#appendix-D.5-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.3">
            <p id="appendix-D.5-1.3.1">Defined the use of "cursor" in the document body, as an extension of diff queries.<a href="#appendix-D.5-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.4">
            <p id="appendix-D.5-1.4.1">Both success and error responses have a CBOR map as payload.<a href="#appendix-D.5-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.5">
            <p id="appendix-D.5-1.5.1">Corner cases of message processing explained more explicitly.<a href="#appendix-D.5-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.6">
            <p id="appendix-D.5-1.6.1">Clarifications and editorial improvements.<a href="#appendix-D.5-1.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-00-01">
<section id="appendix-D.6">
        <h3 id="name-version-00-to-01">
<a href="#appendix-D.6" class="section-number selfRef">D.6. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.6-1.1">
            <p id="appendix-D.6-1.1.1">Added actions to perform upon receiving responses from the TRL endpoint.<a href="#appendix-D.6-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.2">
            <p id="appendix-D.6-1.2.1">Fixed off-by-one error when using the "Cursor" pattern.<a href="#appendix-D.6-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.3">
            <p id="appendix-D.6-1.3.1">Improved error handling, with registered error codes.<a href="#appendix-D.6-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.4">
            <p id="appendix-D.6-1.4.1">Section restructuring (full- and diff-query as self-standing sections).<a href="#appendix-D.6-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.5">
            <p id="appendix-D.6-1.5.1">Renamed identifiers and CBOR parameters.<a href="#appendix-D.6-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.6">
            <p id="appendix-D.6-1.6.1">Clarifications and editorial improvements.<a href="#appendix-D.6-1.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowldegment">
<section id="appendix-E">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-E-1"><span class="contact-name">Ludwig Seitz</span> contributed as a co-author of initial versions of this document.<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<p id="appendix-E-2">The authors sincerely thank <span class="contact-name">Christian Amsüss</span>, <span class="contact-name">Carsten Bormann</span>, <span class="contact-name">Rikard Höglund</span>, <span class="contact-name">Benjamin Kaduk</span>, <span class="contact-name">David Navarro</span>, <span class="contact-name">Joerg Ott</span>, <span class="contact-name">Marco Rasori</span>, <span class="contact-name">Michael Richardson</span>, <span class="contact-name">Jim Schaad</span>, <span class="contact-name">Göran Selander</span> and <span class="contact-name">Travis Spencer</span> for their comments and feedback.<a href="#appendix-E-2" class="pilcrow">¶</a></p>
<p id="appendix-E-3">The work on this document has been partly supported by VINNOVA and the Celtic-Next project CRITISEC; and by the H2020 project SIFIS-Home (Grant agreement 952652).<a href="#appendix-E-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-F">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francesca Palombini</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">Torshamnsgatan 23</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:francesca.palombini@ericsson.com" class="email">francesca.palombini@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Sebastian Echeverria</span></div>
<div dir="auto" class="left"><span class="org">CMU SEI</span></div>
<div dir="auto" class="left"><span class="street-address">4500 Fifth Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Pittsburgh, PA</span>,  <span class="postal-code">15213-2612</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:secheverria@sei.cmu.edu" class="email">secheverria@sei.cmu.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Grace Lewis</span></div>
<div dir="auto" class="left"><span class="org">CMU SEI</span></div>
<div dir="auto" class="left"><span class="street-address">4500 Fifth Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Pittsburgh, PA</span>,  <span class="postal-code">15213-2612</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:glewis@sei.cmu.edu" class="email">glewis@sei.cmu.edu</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
